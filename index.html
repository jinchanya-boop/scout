<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    body { font-family: 'Prompt', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 50%, #ddd6fe 100%); }
    .card-shadow { box-shadow: 0 4px 20px rgba(139, 92, 246, 0.1); }
    .btn-primary { background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%); transition: all 0.3s ease; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3); }
    .signature-pad { border: 2px dashed #c4b5fd; background: #faf5ff; }
    .rubric-item { background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); }
    .modal-overlay { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); }
    .file-input-label { cursor: pointer; background-color: #f3e8ff; border: 2px dashed #c4b5fd; }
    .file-input-label:hover { background-color: #e9d5ff; }
    .image-preview { width: 100%; height: 150px; object-fit: cover; border: 1px solid #ddd6fe; }

    /* START: FINAL PRINT STYLES (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß) */
    @media print {
        /* --- üü¢ [‡πÉ‡∏´‡∏°‡πà] ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÅ‡∏•‡∏∞ Footer --- */
        @page {
            size: A4;
            margin: 1.5cm; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© 1.5cm */

            @bottom-left {
                content: "https://jinchanya-boop.github.io/scout/"; /* URL ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏•‡πà‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
                font-family: 'Sarabun', sans-serif;
                font-size: 9pt;
                color: #666;
                padding-bottom: 0.25cm; /* ‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
            }

            @bottom-right {
                content: "‡∏´‡∏ô‡πâ‡∏≤ " counter(page) " / " counter(pages); /* ‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ */
                font-family: 'Sarabun', sans-serif;
                font-size: 9pt;
                color: #666;
                padding-bottom: 0.25cm; /* ‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
            }
        }

        /* --- Basic setup --- */
        body {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
            background-color: #fff; /* Ensure white background */
        }
        body > *:not(#printArea) {
            display: none;
        }
        #printArea {
            display: block !important;
            visibility: visible !important;
            position: static;
            font-family: 'Sarabun', sans-serif; /* Use the new font */
            font-size: 11pt;
            color: #000;
        }

        /* --- Page control --- */
        .single-page-activity {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            page-break-inside: avoid !important;
            padding: 0; /* üü¢ [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0 (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ @page margin ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß) */
        }
        .page-break {
            page-break-before: always;
        }

        /* --- New Form Styles --- */
        .print-form {
            line-height: 1.8;
        }
        .form-header {
            text-align: center;
            margin-bottom: 1cm;
        }
        .form-header h1 { font-size: 16pt; font-weight: bold; margin: 0; }
        .form-header h2 { font-size: 14pt; margin: 0; }

        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5cm 1.5cm;
            margin-bottom: 0.5cm;
        }
        .data-field {
            display: flex;
            border-bottom: 1px dotted #000;
            padding-bottom: 2px;
        }
        .data-field.full-width {
            grid-column: 1 / -1;
        }
        .data-field.no-border {
            border-bottom: none;
        }
        .data-field strong {
            margin-right: 0.5em;
            white-space: nowrap;
        }
        .data-field span {
            width: 100%;
        }
        
        /* --- üü¢ [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ --- */
        .attendance-item {
            /* margin-left: 1.5cm; */ /* ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å */
            margin-left: 1.5em; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
            white-space: nowrap;
        }
        .attendance-item span {
            display: inline-block;
            /* width: 5em; */ /* ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å */
            /* text-align: center; */ /* ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å */
            margin-left: 0.5em; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç */
            font-weight: bold; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡∏≤ */
        }
        
        .photo-section {
            margin-top: 1cm;
        }
        .photo-section h3 {
            text-align: center;
            font-weight: bold;
            margin-bottom: 0.5cm;
        }
        .photo-grid {
            display: flex;
            justify-content: space-around;
            gap: 1cm;
        }
        .photo-container {
            border: 1px solid #000;
            width: 7cm;
            height: 5cm;
            text-align: center;
            padding: 0.2cm;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .photo-container img {
            max-width: 100%;
            max-height: 4cm;
            object-fit: contain;
            margin-bottom: 0.2cm;
        }
        .photo-container p {
            margin: 0;
        }

        .form-footer {
            margin-top: 1cm;
            display: flex;
            justify-content: flex-end;
        }
        .signature-area {
            width: 7cm;
            text-align: center;
        }
        .signature-box {
            border: 1px solid #000;
            height: 2.5cm;
            margin-bottom: 0.2cm;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .signature-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    }
</style>
</head>
<body class="gradient-bg min-h-screen">
    <header class="bg-white/90 backdrop-blur-md shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="https://img2.pic.in.th/pic/sa1.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤" class="w-12 h-12 rounded-full object-cover">
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</h1>
                        <p class="text-sm text-purple-600"> ‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ ‡∏°.1-‡∏°.3</p>
                    </div>
                </div>
                <select id="gradeSelect" class="px-4 py-2 rounded-lg border border-purple-200 focus:ring-2 focus:ring-purple-500">
                    <option value="m1">‡∏°.1 - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß</option>
                    <option value="m2">‡∏°.2 - ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ</option>
                    <option value="m3">‡∏°.3 - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥</option>
                </select>
            </div>
        </div>
    </header>
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
            <button onclick="openStudentManagement()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-purple-50 transition-colors">
                <div class="flex items-center space-x-3"><span class="text-2xl">üë•</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3><p class="text-sm text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏•‡∏ö ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</p></div></div>
            </button>
            <button onclick="openAttendanceCheck()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-purple-50 transition-colors">
                <div class="flex items-center space-x-3"><span class="text-2xl">‚úÖ</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3><p class="text-sm text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p></div></div>
            </button>
            <button onclick="openActivityStatusDashboard()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-indigo-50 transition-colors">
                <div class="flex items-center space-x-3"><span class="text-2xl">üìë</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3><p class="text-sm text-gray-600">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå</p></div></div>
            </button>
            <button onclick="openDashboard()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-blue-50 transition-colors">
                <div class="flex items-center space-x-3"><span class="text-2xl">üìà</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h3><p class="text-sm text-gray-600">‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</p></div></div>
            </button>
            <button onclick="showActivityReport()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-green-50 transition-colors">
                <div class="flex items-center space-x-3"><span class="text-2xl">üìä</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3><p class="text-sm text-gray-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p></div></div>
            </button>
            <button onclick="showAttendanceReport()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-yellow-50 transition-colors">
                <div class="flex items-center space-x-3"><span class="text-2xl">üìã</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h3><p class="text-sm text-gray-600">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p></div></div>
            </button>
        </div>
        <div class="bg-white/90 backdrop-blur-md rounded-2xl card-shadow p-6 mb-8">
            <div class="flex items-center mb-6"><span class="text-2xl mr-3">üìÖ</span><h2 class="text-2xl font-bold text-gray-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£ Block Course</h2></div>
            <div id="scheduleTable" class="overflow-x-auto"></div>
        </div>
    </main>
    <div id="studentManagementModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><span class="text-2xl">üë•</span><h3 class="text-xl font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3></div><button onclick="closeStudentManagement()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button></div></div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div><label class="block text-sm font-medium mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label><select id="manageGrade" onchange="loadManageStudentList()" class="w-full px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option><option value="‡∏°.1">‡∏°.1</option><option value="‡∏°.2">‡∏°.2</option><option value="‡∏°.3">‡∏°.3</option></select></div>
                    <div><label class="block text-sm font-medium mb-2">‡∏Å‡∏≠‡∏á</label><select id="manageGroup" onchange="updateManageTroopOptions()" class="w-full px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á</option><option value="‡∏Å‡∏≠‡∏á1">‡∏Å‡∏≠‡∏á 1</option><option value="‡∏Å‡∏≠‡∏á2">‡∏Å‡∏≠‡∏á 2</option><option value="‡∏Å‡∏≠‡∏á3">‡∏Å‡∏≠‡∏á 3</option><option value="‡∏Å‡∏≠‡∏á4">‡∏Å‡∏≠‡∏á 4</option></select></div>
                    <div><label class="block text-sm font-medium mb-2">‡∏´‡∏°‡∏π‡πà</label><select id="manageTroop" onchange="loadManageStudentList()" class="w-full px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà</option></select></div>
                    <div class="flex items-end"><button onclick="showAddStudentForm()" class="w-full px-4 py-2 btn-primary text-white rounded-lg font-medium">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button></div>
                </div>
                <div id="studentForm" class="hidden mb-6 p-4 bg-purple-50 rounded-lg"><h4 class="font-medium mb-4" id="formTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h4><form id="addStudentForm"><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-medium mb-1">‡∏ä‡∏∑‡πà‡∏≠</label><input type="text" id="studentFirstName" required class="w-full px-3 py-2 rounded-lg border" placeholder="‡∏ä‡∏∑‡πà‡∏≠"></div><div><label class="block text-sm font-medium mb-1">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="studentLastName" required class="w-full px-3 py-2 rounded-lg border" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div><div><label class="block text-sm font-medium mb-1">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label><input type="text" id="studentId" required class="w-full px-3 py-2 rounded-lg border" placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß"></div></div><div class="flex justify-end space-x-3 mt-4"><button type="button" onclick="hideStudentForm()" class="px-4 py-2 border rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="px-4 py-2 btn-primary text-white rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></form></div>
                <div id="manageStudentList"><div class="text-center text-gray-500 py-8"><span class="text-4xl block mb-2">üë•</span><p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô, ‡∏Å‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p></div></div>
            </div>
        </div>
    </div>
    <div id="attendanceModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><span class="text-2xl">‚úÖ</span><h3 class="text-xl font-bold">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3></div><button onclick="closeAttendanceCheck()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button></div></div>
            <div class="p-6">
               <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"><div><label class="block text-sm font-medium mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="attendanceDate" class="w-full px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"></div><div><label class="block text-sm font-medium mb-2">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label><select id="attendanceActivity" class="w-full px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option><option value="‡πÄ‡∏ä‡πâ‡∏≤">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏ä‡πâ‡∏≤</option><option value="‡∏™‡∏≤‡∏¢">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≤‡∏¢</option><option value="‡∏ö‡πà‡∏≤‡∏¢">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡πà‡∏≤‡∏¢</option></select></div></div>
                <div class="mb-6"><label class="block text-sm font-medium mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label><select id="attendanceGrade" onchange="loadAttendanceStudentList()" class="w-full px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option><option value="‡∏°.1">‡∏°.1</option><option value="‡∏°.2">‡∏°.2</option><option value="‡∏°.3">‡∏°.3</option></select></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"><div><label class="block text-sm font-medium mb-2">‡∏Å‡∏≠‡∏á</label><select id="attendanceGroup" onchange="updateAttendanceTroopOptions()" class="w-full px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á</option><option value="‡∏Å‡∏≠‡∏á1">‡∏Å‡∏≠‡∏á 1</option><option value="‡∏Å‡∏≠‡∏á2">‡∏Å‡∏≠‡∏á 2</option><option value="‡∏Å‡∏≠‡∏á3">‡∏Å‡∏≠‡∏á 3</option><option value="‡∏Å‡∏≠‡∏á4">‡∏Å‡∏≠‡∏á 4</option></select></div><div><label class="block text-sm font-medium mb-2">‡∏´‡∏°‡∏π‡πà</label><select id="attendanceTroop" onchange="loadAttendanceStudentList()" class="w-full px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà</option></select></div></div>
                <div id="attendanceStudentList"><div class="text-center text-gray-500 py-8"><span class="text-4xl block mb-2">‚úÖ</span><p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</p></div></div>
                <div class="flex justify-end mt-6"><button onclick="saveAttendance()" class="px-6 py-2 btn-primary text-white rounded-lg font-medium">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button></div>
            </div>
        </div>
    </div>
    <div id="activityModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><span class="text-2xl">üìù</span><h3 class="text-xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3></div><button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button></div></div>
            <div class="p-6"><form id="activityForm"><div class="mb-6"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium mb-2">üïê ‡πÄ‡∏ß‡∏•‡∏≤</label><input type="text" id="activityTime" class="w-full px-4 py-2 rounded-lg border" readonly></div><div><label class="block text-sm font-medium mb-2">üìã ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label><input type="text" id="activityName" class="w-full px-4 py-2 rounded-lg border" readonly></div></div></div><div class="mb-6"><label class="block text-sm font-medium mb-2">üë• ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô, ‡∏Å‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà</label><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div><label class="block text-xs mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</label><select id="activityGrade" onchange="loadStudentList()" class="w-full px-3 py-2 rounded-lg border"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option><option value="‡∏°.1">‡∏°.1</option><option value="‡∏°.2">‡∏°.2</option><option value="‡∏°.3">‡∏°.3</option></select></div><div><label class="block text-xs mb-1">‡∏Å‡∏≠‡∏á</label><select id="selectedGroup" onchange="updateActivityTroopOptions()" class="w-full px-3 py-2 rounded-lg border"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á</option><option value="‡∏Å‡∏≠‡∏á1">‡∏Å‡∏≠‡∏á 1</option><option value="‡∏Å‡∏≠‡∏á2">‡∏Å‡∏≠‡∏á 2</option><option value="‡∏Å‡∏≠‡∏á3">‡∏Å‡∏≠‡∏á 3</option><option value="‡∏Å‡∏≠‡∏á4">‡∏Å‡∏≠‡∏á 4</option></select></div><div><label class="block text-xs mb-1">‡∏´‡∏°‡∏π‡πà</label><select id="selectedTroop" onchange="loadStudentList()" class="w-full px-3 py-2 rounded-lg border" disabled><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà</option></select></div></div><div id="studentAttendanceList" class="hidden"><div class="bg-purple-50 rounded-lg p-4"><h4 class="font-medium mb-3 flex items-center"><span class="mr-2">üìã</span>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h4><div id="studentCheckList" class="space-y-2"></div></div></div></div><div id="attendanceSummary" class="mt-4 p-4 bg-gray-100 rounded-lg hidden"><h5 class="font-semibold mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠:</h5><div class="flex flex-wrap gap-x-6 gap-y-2 text-sm"><span class="font-medium">‚úÖ ‡∏°‡∏≤: <span id="summaryPresent" class="text-green-600 font-bold">0</span></span><span class="font-medium">üìã ‡∏•‡∏≤: <span id="summaryLeave" class="text-yellow-600 font-bold">0</span></span><span class="font-medium">‚ùå ‡∏Ç‡∏≤‡∏î: <span id="summaryAbsent" class="text-red-600 font-bold">0</span></span><span class="font-medium">üèÉ ‡∏´‡∏ô‡∏µ: <span id="summarySkipped" class="text-orange-600 font-bold">0</span></span></div></div>
            <div class="mb-6 mt-6">
                <h4 class="text-lg font-semibold mb-4 flex items-center"><span class="mr-2">üì∏</span>‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (2 ‡∏†‡∏≤‡∏û)</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="activityPhoto1" class="file-input-label p-4 rounded-lg flex flex-col items-center justify-center text-center">
                            <span class="text-3xl">üñºÔ∏è</span>
                            <span class="mt-2 text-sm font-medium text-purple-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 1</span>
                            <span class="text-xs text-gray-500">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</span>
                        </label>
                        <input type="file" id="activityPhoto1" class="hidden" accept="image/*" onchange="previewImage('activityPhoto1', 'photoPreview1')">
                        <img id="photoPreview1" class="mt-2 rounded-lg image-preview hidden" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 1">
                    </div>
                    <div>
                        <label for="activityPhoto2" class="file-input-label p-4 rounded-lg flex flex-col items-center justify-center text-center">
                            <span class="text-3xl">üñºÔ∏è</span>
                            <span class="mt-2 text-sm font-medium text-purple-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 2</span>
                            <span class="text-xs text-gray-500">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</span>
                        </label>
                        <input type="file" id="activityPhoto2" class="hidden" accept="image/*" onchange="previewImage('activityPhoto2', 'photoPreview2')">
                        <img id="photoPreview2" class="mt-2 rounded-lg image-preview hidden" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 2">
                    </div>
                </div>
            </div>
            <div class="mb-6 mt-6"><h4 class="text-lg font-semibold mb-4 flex items-center"><span class="mr-2">‚≠ê</span>‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</h4><div class="space-y-3" id="rubricItems"></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><div><label class="block text-sm font-medium mb-2">üéØ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</label><input type="number" id="totalScore" min="0" max="100" class="w-full px-4 py-2 rounded-lg border" placeholder="0-100"></div><div><label class="block text-sm font-medium mb-2">üìä ‡∏£‡∏∞‡∏î‡∏±‡∏ö</label><select id="gradeLevel" class="w-full px-4 py-2 rounded-lg border"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</option><option value="‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°">‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (90-100)</option><option value="‡∏î‡∏µ‡∏°‡∏≤‡∏Å">‡∏î‡∏µ‡∏°‡∏≤‡∏Å (80-89)</option><option value="‡∏î‡∏µ">‡∏î‡∏µ (70-79)</option><option value="‡∏û‡∏≠‡πÉ‡∏ä‡πâ">‡∏û‡∏≠‡πÉ‡∏ä‡πâ (60-69)</option><option value="‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á">‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (&lt;60)</option></select></div></div><div class="mb-6"><label class="block text-sm font-medium mb-2">üí¨ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô/‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ó‡πå</label><textarea id="comments" rows="4" class="w-full px-4 py-2 rounded-lg border" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô..."></textarea></div><div class="mb-6"><label class="block text-sm font-medium mb-2">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏Å‡∏≥‡∏Å‡∏±‡∏ö</label><textarea id="notes" rows="3" class="w-full px-4 py-2 rounded-lg border" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea></div><div class="mb-6"><label class="block text-sm font-medium mb-2">‚úçÔ∏è ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏Å‡∏≥‡∏Å‡∏±‡∏ö</label><div class="signature-pad rounded-lg p-4 text-center"><canvas id="signatureCanvas" width="300" height="100" class="border-2 border-dashed rounded-lg mx-auto cursor-crosshair"></canvas><div class="mt-2 space-x-2"><button type="button" onclick="clearSignature()" class="text-sm text-purple-600 hover:text-purple-800">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</button></div></div></div><div class="flex justify-end space-x-3"><button type="button" onclick="closeModal()" class="px-6 py-2 border rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="px-6 py-2 btn-primary text-white rounded-lg font-medium">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></div></form></div>
        </div>
    </div>
     <div id="dashboardModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b sticky top-0 bg-white/80 backdrop-blur-md"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><span class="text-2xl">üìà</span><h3 class="text-xl font-bold">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3></div><button onclick="closeDashboard()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button></div><div class="mt-4"><label for="dashboardGradeFilter" class="text-sm font-medium">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</label><select id="dashboardGradeFilter" onchange="renderDashboardCharts()" class="mt-1 w-full md:w-auto px-3 py-2 rounded-lg border focus:ring-2 focus:ring-purple-500"><option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option><option value="‡∏°.1">‡∏°.1</option><option value="‡∏°.2">‡∏°.2</option><option value="‡∏°.3">‡∏°.3</option></select></div></div>
            <div class="p-6 space-y-8"><div><h4 class="text-lg font-semibold mb-4">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ (‡∏£‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</h4><div class="p-4 bg-gray-50 rounded-lg"><canvas id="attendanceChart"></canvas></div></div><div><h4 class="text-lg font-semibold mb-4">‚≠ê ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</h4><div class="p-4 bg-gray-50 rounded-lg"><canvas id="scoreChart"></canvas></div></div></div>
        </div>
   </div>
    <div id="activityStatusModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-6xl w-full max-h-[90vh] flex flex-col">
            <div class="p-6 border-b">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3"><span class="text-2xl">üìë</span><h3 class="text-xl font-bold">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3></div>
                    <button onclick="closeActivityStatusDashboard()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
            </div>
            <div class="p-6 flex-grow overflow-y-auto">
                <div class="border-b border-gray-200 mb-4">
                    <nav id="statusTabs" class="flex space-x-4" aria-label="Tabs">
                        <a href="#" onclick="renderActivityStatusTable('m1'); setActiveTab(this); return false;" class="status-tab text-purple-600 border-purple-600 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1</a>
                        <a href="#" onclick="renderActivityStatusTable('m2'); setActiveTab(this); return false;" class="status-tab text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2</a>
                        <a href="#" onclick="renderActivityStatusTable('m3'); setActiveTab(this); return false;" class="status-tab text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3</a>
                    </nav>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°</th>
                            </tr>
                        </thead>
                        <tbody id="activityStatusTableBody" class="bg-white divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </div>
            <div class="p-4 border-t bg-gray-50 text-right">
                <button id="printGradeReportBtn" onclick="printGradeReport()" class="px-6 py-2 btn-primary text-white rounded-lg font-medium">
                    ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ
                </button>
            </div>
        </div>
    </div>
    <div id="printArea" class="hidden font-sans"></div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyhidTjPGC6HvQ0Jmv7eIR4IVYKdDqI7nES5Ovexyj-m9QriFYa9Mm9AYBoJr5-Sgzw/exec';
    let studentData = {};
    let editingStudent = null;
    let canvas, ctx, isDrawing = false;
    let attendanceSummaryData = null;
    let activitySummaryData = null;
    let attendanceChartInstance = null;
    let scoreChartInstance = null;
    let recordedActivitiesData = null;
    let currentStatusGrade = 'm1';
    const scheduleData = {
        m1:{title:"‡∏°.1 - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß",focus:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ ‚Äì ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‚Äì ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏π‡πà",schedule:[{time:"08.30 ‚Äì 09.00",day1:"‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î / ‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û‡∏ò‡∏á‡∏ä‡∏≤‡∏ï‡∏¥",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á"},{time:"09.00 ‚Äì 10.00",day1:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏ñ‡∏ß (‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô)",day2:"‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏• (2‚Äì3 ‡∏Å‡∏°.)",day3:"‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ö‡∏≤‡∏î‡πÅ‡∏ú‡∏•‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢"},{time:"10.00 ‚Äì 10.15",day1:"‡∏û‡∏±‡∏Å",day2:"‡∏û‡∏±‡∏Å",day3:"‡∏û‡∏±‡∏Å"},{time:"10.15 ‚Äì 11.15",day1:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡∏û‡∏¥‡∏£‡∏≠‡∏î, ‡∏ï‡∏∞‡∏Å‡∏£‡∏∏‡∏î‡πÄ‡∏ö‡πá‡∏î, ‡∏Ç‡∏±‡∏î‡∏™‡∏°‡∏≤‡∏ò‡∏¥)",day2:"‡∏ù‡∏∂‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®",day3:"‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡πÑ‡∏ü‡∏á‡πà‡∏≤‡∏¢ ‡πÜ"},{time:"11.15 ‚Äì 12.00",day1:"‡πÄ‡∏Å‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Teamwork",day3:"‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ú‡∏π‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô"},{time:"12.00 ‚Äì 13.00",day1:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day2:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day3:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô"},{time:"13.00 ‚Äì 14.30",day1:"‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô",day2:"‡∏ö‡∏≥‡πÄ‡∏û‡πá‡∏ç‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô + ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®)"},{time:"14.30 ‚Äì 15.30",day1:"‡πÄ‡∏Å‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥-‡∏ú‡∏π‡πâ‡∏ï‡∏≤‡∏°",day2:"‡πÄ‡∏û‡∏•‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠",day3:"‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î (Reflection)"},{time:"15.30 ‚Äì 16.00",day1:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day2:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day3:"‡∏û‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î + ‡∏°‡∏≠‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£"}]},
        m2:{title:"‡∏°.2 - ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö",focus:"‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ ‚Äì ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå ‚Äì ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏•‡∏à‡∏£‡∏¥‡∏á ‚Äì ‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏Ç‡∏±‡πâ‡∏ô‡∏Å‡∏•‡∏≤‡∏á",schedule:[{time:"08.30 ‚Äì 09.00",day1:"‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î / ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á"},{time:"09.00 ‚Äì 10.00",day1:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏°‡∏π‡πà, ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ñ‡∏ß)",day2:"‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏• (4‚Äì5 ‡∏Å‡∏°.)",day3:"‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î, ‡∏´‡∏≤‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö)"},{time:"10.00 ‚Äì 10.15",day1:"‡∏û‡∏±‡∏Å",day2:"‡∏û‡∏±‡∏Å",day3:"‡∏û‡∏±‡∏Å"},{time:"10.15 ‚Äì 11.15",day1:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå (‡∏ö‡πà‡∏ß‡∏á‡∏™‡∏≤‡∏¢‡∏ò‡∏ô‡∏π, ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏±‡∏ö‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤)",day2:"‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ / ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ",day3:"‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß"},{time:"11.15 ‚Äì 12.00",day1:"‡πÄ‡∏Å‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥-‡∏ú‡∏π‡πâ‡∏ï‡∏≤‡∏°",day2:"‡∏ê‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à/Team Building",day3:"‡πÄ‡∏Å‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå"},{time:"12.00 ‚Äì 13.00",day1:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day2:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day3:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô"},{time:"13.00 ‚Äì 14.30",day1:"‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà",day2:"‡∏ö‡∏≥‡πÄ‡∏û‡πá‡∏ç‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (‡∏ä‡∏∏‡∏°‡∏ä‡∏ô/‡∏ß‡∏±‡∏î)",day3:"‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ê‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô + ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏® + ‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•)"},{time:"14.30 ‚Äì 15.30",day1:"‡πÄ‡∏Å‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡∏°",day2:"‡πÄ‡∏û‡∏•‡∏á‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î"},{time:"15.30 ‚Äì 16.00",day1:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day2:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day3:"‡∏û‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î + ‡∏°‡∏≠‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£"}]},
        m3:{title:"‡∏°.3 - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î",focus:"‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥ ‚Äì ‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‚Äì ‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î ‚Äì ‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ",schedule:[{time:"08.30 ‚Äì 09.00",day1:"‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î / ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á"},{time:"09.00 ‚Äì 10.00",day1:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏ñ‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤ (‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏π‡πà)",day2:"‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏• (6‚Äì8 ‡∏Å‡∏°. + ‡∏ê‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á)",day3:"‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (‡∏î‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å, ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢)"},{time:"10.00 ‚Äì 10.15",day1:"‡∏û‡∏±‡∏Å",day2:"‡∏û‡∏±‡∏Å",day3:"‡∏û‡∏±‡∏Å"},{time:"10.15 ‚Äì 11.15",day1:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏ú‡∏π‡∏Å‡∏£‡∏≠‡∏Å, ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏°‡∏≠)",day2:"‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô / ‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô",day3:"‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î (‡∏´‡∏≤‡∏ô‡πâ‡∏≥, ‡∏´‡∏≤‡∏ó‡∏¥‡∏®‡∏à‡∏≤‡∏Å‡∏î‡∏ß‡∏á‡∏î‡∏≤‡∏ß)"},{time:"11.15 ‚Äì 12.00",day1:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥ (‡∏ù‡∏∂‡∏Å‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å)",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏ê‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢",day3:"‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏°.3 ‡∏à‡∏±‡∏î‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏á ‡∏°.1‚Äì‡∏°.2"},{time:"12.00 ‚Äì 13.00",day1:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day2:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day3:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô"},{time:"13.00 ‚Äì 14.30",day1:"‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®",day2:"‡∏ö‡∏≥‡πÄ‡∏û‡πá‡∏ç‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏•‡πá‡∏Å ‡πÜ)",day3:"‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ê‡∏≤‡∏ô‡∏£‡∏ß‡∏° (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô + ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏® + ‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• + ‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥)"},{time:"14.30 ‚Äì 15.30",day1:"‡πÄ‡∏Å‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥-‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à",day2:"‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå (Mini Camp Fire)",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î"},{time:"15.30 ‚Äì 16.00",day1:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day2:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day3:"‡∏û‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î + ‡∏°‡∏≠‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£"}]}
    };
    const rubricCriteria = {
        default:[{criteria:"‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",maxScore:25},{criteria:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠‡πÉ‡∏ô‡∏ó‡∏µ‡∏°",maxScore:25},{criteria:"‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö",maxScore:25},{criteria:"‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö",maxScore:25}],
        skill:[{criteria:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ",maxScore:30},{criteria:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥",maxScore:25},{criteria:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢",maxScore:25},{criteria:"‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á",maxScore:20}],
        leadership:[{criteria:"‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥",maxScore:30},{criteria:"‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£",maxScore:25},{criteria:"‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à",maxScore:25},{criteria:"‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å",maxScore:20}]
    };

    document.addEventListener('DOMContentLoaded', function () {
        fetchStudents();
        document.getElementById('gradeSelect').addEventListener('change', loadSchedule);
    });

    async function fetchStudents() {
       try {
            const response = await fetch(SCRIPT_URL + '?action=getStudents');
            if (!response.ok) throw new Error('Network response was not ok');
           studentData = await response.json();
            console.log('Student data loaded successfully:', studentData);
        } catch (error) {
            console.error('Failed to fetch students:', error);
            Swal.fire({icon: 'error', title: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏´‡∏£‡∏∑‡∏≠ Google Apps Script', confirmButtonColor: '#8b5cf6'});
        } finally {
            loadSchedule();
        }
    }

    async function postData(payload) {
        try {
            const response = await fetch(SCRIPT_URL, {method: 'POST', mode: 'cors', headers: {'Content-Type': 'text/plain;charset=utf-8'}, body: JSON.stringify(payload)});
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const result = await response.json();
            if (result.status !== 'success') throw new Error(result.message || 'Unknown error');
            return result;
        } catch (error) {
            console.error('Error posting data:', error);
            throw error;
        }
    }

    function openDashboard(){document.getElementById('dashboardModal').classList.remove('hidden');if(!attendanceSummaryData||!activitySummaryData){loadDashboardData();}else{renderDashboardCharts();}}
    function closeDashboard(){document.getElementById('dashboardModal').classList.add('hidden');}
    async function loadDashboardData(){Swal.fire({title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',allowOutsideClick:false,didOpen:()=>Swal.showLoading()});try{const[attendanceRes,activityRes]=await Promise.all([fetch(SCRIPT_URL+'?action=getAttendanceSummary'),fetch(SCRIPT_URL+'?action=getActivitySummary')]);if(!attendanceRes.ok||!activityRes.ok){throw new Error('Could not load summary data');}
    attendanceSummaryData=await attendanceRes.json();activitySummaryData=await activityRes.json();renderDashboardCharts();Swal.close();}catch(error){console.error('Failed to load dashboard data:',error);Swal.fire({icon:'error',title:'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',text:'‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÑ‡∏î‡πâ'});}}
    function renderDashboardCharts(){if(!attendanceSummaryData||!activitySummaryData){return;}
    const gradeFilterValue=document.getElementById('dashboardGradeFilter').value;const gradeMapping={"‡∏°.1":"‡∏°.1","‡∏°.2":"‡∏°.2","‡∏°.3":"‡∏°.3","all":"all"};const selectedGrade=gradeMapping[gradeFilterValue];const attendanceLabels=[];const attendanceData={present:[],leave:[],absent:[],skipped:[]};for(const gradeKey in attendanceSummaryData){if(selectedGrade!=='all'&&gradeKey!==selectedGrade)continue;for(const group in attendanceSummaryData[gradeKey]){for(const troop in attendanceSummaryData[gradeKey][group]){const troopData=attendanceSummaryData[gradeKey][group][troop];const label=`${gradeKey}/${group}/${troop}`;attendanceLabels.push(label);attendanceData.present.push(troopData['‡∏°‡∏≤']||0);attendanceData.leave.push(troopData['‡∏•‡∏≤']||0);attendanceData.absent.push(troopData['‡∏Ç‡∏≤‡∏î']||0);attendanceData.skipped.push(troopData['‡∏´‡∏ô‡∏µ']||0);}}}
    const scoreLabels=[];const scoreData=[];for(const gradeKey in activitySummaryData){if(selectedGrade!=='all'&&gradeKey!==selectedGrade)continue;for(const group in activitySummaryData[gradeKey].groups){for(const troop in activitySummaryData[gradeKey].groups[group].troops){const troopData=activitySummaryData[gradeKey].groups[group].troops[troop];const label=`${gradeKey}/${group}/${troop}`;const avgScore=troopData.count>0?(troopData.totalScore/troopData.count).toFixed(2):0;scoreLabels.push(label);scoreData.push(avgScore);}}}
    if(attendanceChartInstance)attendanceChartInstance.destroy();if(scoreChartInstance)scoreChartInstance.destroy();
    const attendanceCtx=document.getElementById('attendanceChart').getContext('2d');attendanceChartInstance=new Chart(attendanceCtx,{type:'bar',data:{labels:attendanceLabels,datasets:[{label:'‡∏°‡∏≤',data:attendanceData.present,backgroundColor:'#10B981'},{label:'‡∏•‡∏≤',data:attendanceData.leave,backgroundColor:'#F59E0B'},{label:'‡∏Ç‡∏≤‡∏î',data:attendanceData.absent,backgroundColor:'#EF4444'},{label:'‡∏´‡∏ô‡∏µ',data:attendanceData.skipped,backgroundColor:'#F97316'}]},options:{responsive:true,scales:{x:{stacked:true},y:{stacked:true,beginAtZero:true}},plugins:{title:{display:true,text:'‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ (‡∏£‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á)'},tooltip:{mode:'index'}}}});
    const scoreCtx=document.getElementById('scoreChart').getContext('2d');scoreChartInstance=new Chart(scoreCtx,{type:'bar',data:{labels:scoreLabels,datasets:[{label:'‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',data:scoreData,backgroundColor:'rgba(139, 92, 246, 0.6)',borderColor:'rgba(139, 92, 246, 1)',borderWidth:1}]},options:{responsive:true,scales:{y:{beginAtZero:true,max:100}},plugins:{title:{display:true,text:'‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà'}}}});}
    function loadSchedule(){const selectedGrade=document.getElementById('gradeSelect').value;const data=scheduleData[selectedGrade];const tableContainer=document.getElementById('scheduleTable');let html=`<div class="mb-4"><h3 class="text-lg font-semibold text-purple-800">${data.title}</h3><p class="text-sm text-gray-600 mt-1"><strong>‡∏à‡∏∏‡∏î‡πÄ‡∏ô‡πâ‡∏ô:</strong> ${data.focus}</p></div><div class="overflow-x-auto"><table class="w-full border-collapse"><thead><tr class="bg-gradient-to-r from-purple-500 to-purple-600 text-white"><th class="border p-3 text-left">‡πÄ‡∏ß‡∏•‡∏≤</th><th class="border p-3 text-left">‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å</th><th class="border p-3 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á</th><th class="border p-3 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°</th></tr></thead><tbody>`;data.schedule.forEach(row=>{const isBreak=row.day1.includes('‡∏û‡∏±‡∏Å');const btn=(day,activity)=>!isBreak?`<button onclick="openActivityModal('${row.time}','${activity.replace(/'/g,"\\'")}',${day})" class="ml-2 px-2 py-1 bg-purple-500 text-white text-xs rounded-full hover:bg-purple-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>`:'';html+=`<tr class="${isBreak?'bg-purple-50':'bg-white hover:bg-purple-50'}"><td class="border p-3 font-medium text-purple-700">${row.time}</td><td class="border p-3"><div class="flex items-center justify-between"><span>${row.day1}</span>${btn(1,row.day1)}</div></td><td class="border p-3"><div class="flex items-center justify-between"><span>${row.day2}</span>${btn(2,row.day2)}</div></td><td class="border p-3"><div class="flex items-center justify-between"><span>${row.day3}</span>${btn(3,row.day3)}</div></td></tr>`;});html+=`</tbody></table></div>`;tableContainer.innerHTML=html;}
    function loadManageStudentList(){const grade=document.getElementById('manageGrade').value;const group=document.getElementById('manageGroup').value;const troop=document.getElementById('manageTroop').value;const container=document.getElementById('manageStudentList');const students=studentData[grade]?.[group]?.[troop]||[];if(grade&&group&&troop){let html=`<div class="bg-purple-50 rounded-lg p-4 mb-4"><h4 class="font-medium">${grade} / ${group} / ${troop} - (${students.length} ‡∏Ñ‡∏ô)</h4></div><div class="space-y-3">`;if(students.length>0){students.forEach((student,index)=>{html+=`<div class="flex items-center justify-between p-4 bg-white rounded-lg border"><div class="flex items-center space-x-4"><div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center"><span class="text-purple-600 font-medium">${index+1}</span></div><div><div class="font-medium">${student.firstName} ${student.lastName}</div><div class="text-sm text-gray-500">ID: ${student.id}</div></div></div><div class="flex space-x-2"><button onclick="editStudent('${grade}','${group}','${troop}',${index})" class="px-3 py-1 bg-blue-500 text-white text-sm rounded-lg">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button onclick="deleteStudent('${grade}','${group}','${troop}',${index})" class="px-3 py-1 bg-red-500 text-white text-sm rounded-lg">‡∏•‡∏ö</button></div></div>`;});}else{html+=`<p class="text-center text-gray-500">-- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</p>`;}

    html+='</div>';container.innerHTML=html;}else{container.innerHTML=`<div class="text-center text-gray-500 py-8"><span class="text-4xl block mb-2">üë•</span><p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô, ‡∏Å‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà</p></div>`;}}

    function showAddStudentForm(){const grade=document.getElementById('manageGrade').value;const group=document.getElementById('manageGroup').value;const troop=document.getElementById('manageTroop').value;if(!grade||!group||!troop){Swal.fire({icon:'warning',title:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö',text:'‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô, ‡∏Å‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',confirmButtonColor:'#8b5cf6'});return;}

    editingStudent=null;document.getElementById('formTitle').textContent=`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (${grade}/${group}/${troop})`;document.getElementById('addStudentForm').reset();document.getElementById('studentForm').classList.remove('hidden');}

    async function saveStudent(){const grade=document.getElementById('manageGrade').value;const group=document.getElementById('manageGroup').value;const troop=document.getElementById('manageTroop').value;const firstName=document.getElementById('studentFirstName').value.trim();const lastName=document.getElementById('studentLastName').value.trim();const studentId=document.getElementById('studentId').value.trim();const studentObj={id:studentId,firstName,lastName,grade,group,troop};const payload={type:'manageStudent',action:editingStudent?'edit':'add',student:studentObj,...(editingStudent&&{originalId:editingStudent.originalId})};Swal.fire({title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...',willOpen:()=>Swal.showLoading()});try{await postData(payload);await fetchStudents();hideStudentForm();loadManageStudentList();Swal.fire({icon:'success',title:editingStudent?'‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à':'‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'});}catch(error){Swal.fire({icon:'error',title:'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',text:'‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: '+error.message});}}

    function editStudent(grade,group,troop,index){const student=studentData[grade]?.[group]?.[troop]?.[index];if(!student)return;editingStudent={grade,group,troop,index,originalId:student.id};document.getElementById('formTitle').textContent=`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${grade}/${group}/${troop})`;document.getElementById('studentFirstName').value=student.firstName;document.getElementById('studentLastName').value=student.lastName;

    document.getElementById('studentId').value=student.id;document.getElementById('studentForm').classList.remove('hidden');}

    function deleteStudent(grade,group,troop,index){const student=studentData[grade]?.[group]?.[troop]?.[index];if(!student)return;Swal.fire({title:'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö',text:`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${student.firstName} ${student.lastName} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,icon:'warning',showCancelButton:true,confirmButtonText:'‡∏•‡∏ö',cancelButtonText:'‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'}).then(async(result)=>{if(result.isConfirmed){Swal.fire({title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...',willOpen:()=>Swal.showLoading()});try{await postData({type:'manageStudent',action:'delete',student:{id:student.id,grade,group,troop}});await fetchStudents();loadManageStudentList();Swal.fire({icon:'success',title:'‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'});}catch(error){Swal.fire({icon:'error',title:'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',text:'‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: '+error.message});}}});}

    function loadAttendanceStudentList(){const grade=document.getElementById('attendanceGrade').value;const group=document.getElementById('attendanceGroup').value;const troop=document.getElementById('attendanceTroop').value;const container=document.getElementById('attendanceStudentList');const students=studentData[grade]?.[group]?.[troop]||[];if(grade&&group&&troop){let html=`<div class="bg-purple-50 rounded-lg p-4 mb-4"><h4 class="font-medium">${grade} / ${group} / ${troop} - (${students.length} ‡∏Ñ‡∏ô)</h4></div><div class="space-y-3">`;if(students.length>0){students.forEach(student=>{html+=`<div class="flex items-center justify-between p-4 bg-white rounded-lg border"><div class="flex items-center space-x-3"><div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center"><span class="text-purple-600 font-medium">${student.firstName.charAt(0)}</span></div><div><div class="font-medium">${student.firstName} ${student.lastName}</div><div class="text-sm text-gray-500">ID: ${student.id}</div></div></div><div class="flex flex-wrap gap-x-3 gap-y-2"><label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="attendance_${student.id}" value="‡∏°‡∏≤" checked><span>‡∏°‡∏≤</span></label><label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="attendance_${student.id}" value="‡∏•‡∏≤"><span>‡∏•‡∏≤</span></label><label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="attendance_${student.id}" value="‡∏Ç‡∏≤‡∏î"><span>‡∏Ç‡∏≤‡∏î</span></label><label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="attendance_${student.id}" value="‡∏´‡∏ô‡∏µ"><span>‡∏´‡∏ô‡∏µ</span></label></div></div>`;});}else{html+=`<p class="text-center text-gray-500 py-4">-- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</p>`;}

    html+='</div>';container.innerHTML=html;}else{container.innerHTML=`<div class="text-center text-gray-500 py-8"><span class="text-4xl block mb-2">‚úÖ</span><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏π‡πà</p></div>`;}}

    async function saveAttendance(){const date=document.getElementById('attendanceDate').value;const activity=document.getElementById('attendanceActivity').value;const grade=document.getElementById('attendanceGrade').value;const group=document.getElementById('attendanceGroup').value;const troop=document.getElementById('attendanceTroop').value;if(!date||!activity||!grade||!group||!troop){Swal.fire({icon:'warning',title:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö',confirmButtonColor:'#8b5cf6'});return;}

    const students=studentData[grade]?.[group]?.[troop]||[];if(students.length===0){Swal.fire({icon:'info',title:'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ',confirmButtonColor:'#8b5cf6'});return;}

    const attendanceData=students.map(student=>({studentId:student.id,studentName:`${student.firstName} ${student.lastName}`,status:document.querySelector(`input[name="attendance_${student.id}"]:checked`)?.value||'‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}));const payload={type:'attendance',date,activity,grade,group,troop,attendanceData};Swal.fire({title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...',willOpen:()=>Swal.showLoading()});try{await postData(payload);showSuccessMessage(payload,false);}catch(error){showSuccessMessage(payload,true);console.error('Failed to save attendance:',error);}}

    function loadStudentList(){const grade=document.getElementById('activityGrade').value;const group=document.getElementById('selectedGroup').value;const troop=document.getElementById('selectedTroop').value;const container=document.getElementById('studentCheckList');const wrapper=document.getElementById('studentAttendanceList');const summary=document.getElementById('attendanceSummary');const students=studentData[grade]?.[group]?.[troop]||[];if(grade&&group&&troop){let html='';if(students.length>0){students.forEach(student=>{html+=`<div class="flex items-center justify-between p-3 bg-white rounded-lg border"><div class="flex items-center space-x-3"><span class="font-medium">${student.firstName} ${student.lastName} (${student.id})</span></div><div class="flex space-x-2"><label class="flex items-center space-x-1 cursor-pointer"><input type="radio" onchange="updateAttendanceSummary()" name="activity_attendance_${student.id}" value="‡∏°‡∏≤" checked><span class="text-sm">‡∏°‡∏≤</span></label><label class="flex items-center space-x-1 cursor-pointer"><input type="radio" onchange="updateAttendanceSummary()" name="activity_attendance_${student.id}" value="‡∏•‡∏≤"><span class="text-sm">‡∏•‡∏≤</span></label><label class="flex items-center space-x-1 cursor-pointer"><input type="radio" onchange="updateAttendanceSummary()" name="activity_attendance_${student.id}" value="‡∏Ç‡∏≤‡∏î"><span class="text-sm">‡∏Ç‡∏≤‡∏î</span></label><label class="flex items-center space-x-1 cursor-pointer"><input type="radio" onchange="updateAttendanceSummary()" name="activity_attendance_${student.id}" value="‡∏´‡∏ô‡∏µ"><span class="text-sm">‡∏´‡∏ô‡∏µ</span></label></div></div>`;});}else{html=`<p class="text-center text-gray-500 py-2">-- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô --</p>`;}

    container.innerHTML=html;wrapper.classList.remove('hidden');summary.classList.remove('hidden');updateAttendanceSummary();}else{container.innerHTML='';wrapper.classList.add('hidden');summary.classList.add('hidden');}}

    function updateAttendanceSummary(){const container=document.getElementById('studentCheckList');if(!container)return;const present=container.querySelectorAll('input[value="‡∏°‡∏≤"]:checked').length;const leave=container.querySelectorAll('input[value="‡∏•‡∏≤"]:checked').length;const absent=container.querySelectorAll('input[value="‡∏Ç‡∏≤‡∏î"]:checked').length;const skipped=container.querySelectorAll('input[value="‡∏´‡∏ô‡∏µ"]:checked').length;document.getElementById('summaryPresent').innerText=present;document.getElementById('summaryLeave').innerText=leave;document.getElementById('summaryAbsent').innerText=absent;document.getElementById('summarySkipped').innerText=skipped;}

    function previewImage(inputId, previewId) {

        const input = document.getElementById(inputId);

        const preview = document.getElementById(previewId);

        if (input.files && input.files[0]) {

            const reader = new FileReader();

            reader.onload = function(e) {

                preview.src = e.target.result;

                preview.classList.remove('hidden');

            }

            reader.readAsDataURL(input.files[0]);

        }

    }

    

    function resizeImage(file, maxWidth = 800, maxHeight = 800, quality = 0.8) {

        return new Promise((resolve, reject) => {

            const reader = new FileReader();

            reader.readAsDataURL(file);

            reader.onload = (event) => {

                const img = new Image();

                img.src = event.target.result;

                img.onload = () => {

                    const canvas = document.createElement('canvas');

                    let width = img.width;

                    let height = img.height;

                    if (width > height) {

                        if (width > maxWidth) {

                            height *= maxWidth / width;

                            width = maxWidth;

                        }

                    } else {

                        if (height > maxHeight) {

                            width *= maxHeight / height;

                            height = maxHeight;

                        }

                    }

                    canvas.width = width;

                    canvas.height = height;

                    const ctx = canvas.getContext('2d');

                    ctx.drawImage(img, 0, 0, width, height);

                    resolve(canvas.toDataURL('image/jpeg', quality));

                };

                img.onerror = reject;

            };

            reader.onerror = reject;

        });

    }



    async function saveActivityRecord() {

        Swal.fire({

            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',

            html: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...',

            allowOutsideClick: false,

            didOpen: () => { Swal.showLoading(); }

        });

        const file1 = document.getElementById('activityPhoto1').files[0];

        const file2 = document.getElementById('activityPhoto2').files[0];

        let photo1_base64 = '';

        let photo2_base64 = '';

        try {

            if (file1) photo1_base64 = await resizeImage(file1);

            if (file2) photo2_base64 = await resizeImage(file2);

        } catch (error) {

            Swal.fire({

                icon: 'error',

                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',

                text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ!'

            });

            console.error("Image processing error:", error);

            return;

        }

        const rubricScores = {};

        document.querySelectorAll('[id^="rubric_"]').forEach((item, index) => {

            rubricScores[`criteria_${index}`] = item.value;

        });

        const signatureData = canvas ? canvas.toDataURL('image/png', 0.5) : '';

        const payload = {

            type: 'activity',

            timestamp: new Date().toISOString(),

            grade: document.getElementById('activityGrade').value,

            time: document.getElementById('activityTime').value,

            activity: document.getElementById('activityName').value,

            selectedGroup: document.getElementById('selectedGroup').value,

            selectedTroop: document.getElementById('selectedTroop').value,

            totalScore: document.getElementById('totalScore').value,

            gradeLevel: document.getElementById('gradeLevel').value,

            comments: document.getElementById('comments').value,

            notes: document.getElementById('notes').value,

            signature: signatureData,

            rubricScores,

            summaryPresent: document.getElementById('summaryPresent').innerText,

            summaryLeave: document.getElementById('summaryLeave').innerText,

            summaryAbsent: document.getElementById('summaryAbsent').innerText,

            summarySkipped: document.getElementById('summarySkipped').innerText,

            photo1: photo1_base64,

            photo2: photo2_base64

        };

        try {

            await postData(payload);

            showSuccessMessage(payload, false);

        } catch (error) {

            showSuccessMessage(payload, true);

            console.error('Failed to save activity to Sheet:', error);

        }

    }



    function updateTroopOptions(groupElId,troopElId){const groupSelect=document.getElementById(groupElId);const troopSelect=document.getElementById(troopElId);troopSelect.innerHTML='<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà</option>';if(groupSelect.value){for(let i=1;i<=4;i++){troopSelect.innerHTML+=`<option value="‡∏´‡∏°‡∏π‡πà${i}">‡∏´‡∏°‡∏π‡πà ${i}</option>`;}}}

    function updateManageTroopOptions(){updateTroopOptions('manageGroup','manageTroop');loadManageStudentList();}

    function updateAttendanceTroopOptions(){updateTroopOptions('attendanceGroup','attendanceTroop');loadAttendanceStudentList();}

    function updateActivityTroopOptions(){updateTroopOptions('selectedGroup','selectedTroop');document.getElementById('selectedTroop').disabled=!document.getElementById('selectedGroup').value;loadStudentList();}

    function openStudentManagement(){document.getElementById('studentManagementModal').classList.remove('hidden');document.getElementById('addStudentForm').addEventListener('submit',(e)=>{e.preventDefault();saveStudent();});}

    function closeStudentManagement(){document.getElementById('studentManagementModal').classList.add('hidden');hideStudentForm();}

    function openAttendanceCheck(){document.getElementById('attendanceModal').classList.remove('hidden');document.getElementById('attendanceDate').value=new Date().toISOString().split('T')[0];}

    function closeAttendanceCheck(){document.getElementById('attendanceModal').classList.add('hidden');}

    function openActivityModal(time,activity,day){document.getElementById('activityModal').classList.remove('hidden');document.getElementById('activityTime').value=time;document.getElementById('activityName').value=activity;let criteriaKey='default';if(['‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô','‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®','‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•'].some(s=>activity.includes(s)))criteriaKey='skill';else if(['‡∏ú‡∏π‡πâ‡∏ô‡∏≥','‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤'].some(s=>activity.includes(s)))criteriaKey='leadership';loadRubricItems(rubricCriteria[criteriaKey]);setupSignatureCanvas();document.getElementById('activityForm').addEventListener('submit',(e)=>{e.preventDefault();saveActivityRecord();});}

    function closeModal() {

        document.getElementById('activityModal').classList.add('hidden');

        document.getElementById('activityForm').reset();

        document.getElementById('photoPreview1').classList.add('hidden');

        document.getElementById('photoPreview1').src = '';

        document.getElementById('photoPreview2').classList.add('hidden');

        document.getElementById('photoPreview2').src = '';

        clearSignature();

    }

    function hideStudentForm(){document.getElementById('studentForm').classList.add('hidden');editingStudent=null;document.getElementById('addStudentForm').reset();}

    function loadRubricItems(criteria){const container=document.getElementById('rubricItems');container.innerHTML=criteria.map((item,index)=>`<div class="rubric-item rounded-lg p-4 border"><div class="flex items-center justify-between mb-2"><span class="font-medium">${item.criteria}</span><span class="text-sm text-purple-600">‡πÄ‡∏ï‡πá‡∏°: ${item.maxScore}</span></div><div class="flex items-center space-x-4"><input type="range" min="0" max="${item.maxScore}" value="0" class="flex-1" id="rubric_${index}" oninput="updateRubricScore()"><span id="score_${index}" class="font-bold text-purple-600 min-w-[60px]">0/${item.maxScore}</span></div></div>`).join('');updateRubricScore();}

    function updateRubricScore(){let total=0;document.querySelectorAll('[id^="rubric_"]').forEach((item,index)=>{const value=parseInt(item.value);const maxScore=parseInt(item.max);document.getElementById(`score_${index}`).textContent=`${value}/${maxScore}`;total+=value;});document.getElementById('totalScore').value=total;const gradeSelect=document.getElementById('gradeLevel');if(total>=90)gradeSelect.value='‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°';else if(total>=80)gradeSelect.value='‡∏î‡∏µ‡∏°‡∏≤‡∏Å';else if(total>=70)gradeSelect.value='‡∏î‡∏µ';else if(total>=60)gradeSelect.value='‡∏û‡∏≠‡πÉ‡∏ä‡πâ';else gradeSelect.value='‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á';}

    function setupSignatureCanvas(){canvas=document.getElementById('signatureCanvas');if(!canvas)return;ctx=canvas.getContext('2d');clearSignature();['mousedown','touchstart'].forEach(evt=>canvas.addEventListener(evt,startDraw));['mousemove','touchmove'].forEach(evt=>canvas.addEventListener(evt,draw));['mouseup','mouseout','touchend'].forEach(evt=>canvas.addEventListener(evt,stopDraw));}

    function getCoords(e){const rect=canvas.getBoundingClientRect();const touch=e.touches?.[0];return[(e.clientX||touch.clientX)-rect.left,(e.clientY||touch.clientY)-rect.top];}

    function startDraw(e){e.preventDefault();isDrawing=true;[ctx.lastX,ctx.lastY]=getCoords(e);}

    function draw(e){if(!isDrawing)return;e.preventDefault();drawLine(...getCoords(e));}

    function stopDraw(){isDrawing=false;}

    function drawLine(x,y){ctx.beginPath();ctx.moveTo(ctx.lastX,ctx.lastY);ctx.lineTo(x,y);ctx.strokeStyle='#8b5cf6';ctx.lineWidth=2;ctx.lineCap='round';ctx.stroke();[ctx.lastX,ctx.lastY]=[x,y];}

    function clearSignature(){if(!ctx)return;ctx.fillStyle='#faf5ff';ctx.fillRect(0,0,canvas.width,canvas.height);}

    function saveDataLocally(data, key) {

        try {

            const records = JSON.parse(localStorage.getItem(key) || '[]');

            records.push(data);

            localStorage.setItem(key, JSON.stringify(records));

        } catch (error) { 

            console.error('Error saving locally:', error); 

        }

    }

    function showSuccessMessage(data,isOffline=false){const statusHtml=`<div class="mt-4 p-3 ${isOffline?'bg-yellow-100':'bg-green-100'} rounded-lg text-sm">${isOffline?'‚ö†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô':'‚òÅÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Sheets ‡πÅ‡∏•‡πâ‡∏ß'}</div>`;if(data.type==='attendance'){closeAttendanceCheck();Swal.fire({icon:'success',title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',html:`<div class="text-left"><p><strong>‡∏Å‡∏•‡∏∏‡πà‡∏°:</strong> ${data.grade}/${data.group}/${data.troop}</p></div>`+statusHtml,confirmButtonColor:'#8b5cf6'});}else{closeModal();closeActivityStatusDashboard();openActivityStatusDashboard();Swal.fire({icon:'success',title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',html:`<div class="text-left"><p><strong>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</strong> ${data.activity}</p><p><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</strong> ${data.totalScore}/100</p></div>`+statusHtml,confirmButtonColor:'#8b5cf6'});}}

    async function showActivityReport(){Swal.fire({title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô...',didOpen:()=>Swal.showLoading()});try{const response=await fetch(SCRIPT_URL+'?action=getActivitySummary');const summary=await response.json();if(Object.keys(summary).length===0){return Swal.fire({icon:'info',title:'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'});}

    let reportHtml='<div class="max-h-[70vh] overflow-y-auto text-left space-y-2">';for(const gradeName in summary){const gradeData=summary[gradeName];const gradeAvg=(gradeData.totalScore/gradeData.count).toFixed(2);reportHtml+=`<details class="bg-gray-100 rounded-xl border overflow-hidden"><summary class="p-4 font-bold text-xl flex justify-between"><span>${gradeName.toUpperCase()}</span><span>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${gradeAvg}</span></summary><div class="px-4 py-2 border-t space-y-3">`;for(const groupName in gradeData.groups){const groupData=gradeData.groups[groupName];const groupAvg=(groupData.totalScore/groupData.count).toFixed(2);reportHtml+=`<details class="bg-purple-50 rounded-lg border"><summary class="p-3 font-semibold text-lg flex justify-between"><span>${groupName}</span><span>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${groupAvg}</span></summary><div class="p-3 border-t space-y-2">`;for(const troopName in groupData.troops){const troopData=groupData.troops[troopName];const troopAvg=(troopData.totalScore/troopData.count).toFixed(2);const activitiesHtml=troopData.activities.map(act=>`<div class="flex justify-between text-sm py-1 pl-4"><span>- ${act.name}</span><span>${act.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span></div>`).join('');reportHtml+=`<details class="bg-white rounded-md border"><summary class="p-2 font-medium flex justify-between"><span>${troopName}</span><span class="text-sm">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${troopAvg} (${troopData.count} ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°)</span></summary><div class="px-2 pb-1 border-t">${activitiesHtml}</div></details>`;}

    reportHtml+=`</div></details>`;}

    reportHtml+=`</div></details>`;}

    reportHtml+='</div>';Swal.fire({title:'üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',html:reportHtml,width:'800px',confirmButtonText:'‡∏õ‡∏¥‡∏î'});}catch(error){Swal.fire({icon:'error',title:'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',text:'‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ'});}}

    async function showAttendanceReport(){Swal.fire({title:'‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô...',didOpen:()=>Swal.showLoading()});try{const response=await fetch(SCRIPT_URL+'?action=getAttendanceSummary');const summary=await response.json();if(Object.keys(summary).length===0){return Swal.fire({icon:'info',title:'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠'});}

    let reportHtml='<div class="max-h-[60vh] overflow-y-auto text-left space-y-2">';const statusOrder=['‡∏°‡∏≤','‡∏•‡∏≤','‡∏Ç‡∏≤‡∏î','‡∏´‡∏ô‡∏µ'];for(const grade in summary){for(const group in summary[grade]){for(const troop in summary[grade][group]){const data=summary[grade][group][troop];const totalEnrolled=studentData[grade]?.[group]?.[troop]?.length||0;let statusText=statusOrder.filter(status=>data[status]).map(status=>`${status} ${data[status]}`).join(', ');reportHtml+=`<div class="p-3 bg-green-50 border rounded-lg"><div class="font-semibold">${grade} ${group} ${troop}</div><div class="text-sm text-gray-600">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalEnrolled} ‡∏Ñ‡∏ô: ${statusText}</div></div>`;}}}

    reportHtml+='</div>';Swal.fire({title:'‚úÖ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠',html:reportHtml,width:'600px',confirmButtonText:'‡∏õ‡∏¥‡∏î'});}catch(error){Swal.fire({icon:'error',title:'‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',text:'‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ'});}}

    

    async function openActivityStatusDashboard() {

        document.getElementById('activityStatusModal').classList.remove('hidden');

        Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

        try {

            const response = await fetch(SCRIPT_URL + '?action=getRecordedActivities');

            if (!response.ok) throw new Error('Failed to fetch recorded activities.');

            recordedActivitiesData = await response.json();

            renderActivityStatusTable('m1');

            setActiveTab(document.querySelector('.status-tab'));

        } catch (error) {

            console.error(error);

            Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏î‡πâ', 'error');

        } finally {

            Swal.close();

        }

    }



    function closeActivityStatusDashboard() {

        document.getElementById('activityStatusModal').classList.add('hidden');

    }



    function setActiveTab(selectedTab) {

        document.querySelectorAll('.status-tab').forEach(tab => {

            tab.classList.remove('text-purple-600', 'border-purple-600');

            tab.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

        });

        selectedTab.classList.add('text-purple-600', 'border-purple-600');

        selectedTab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

    }



    function renderActivityStatusTable(gradeKey) {

        currentStatusGrade = gradeKey;

        const gradeMap = { 'm1': '‡∏°.1', 'm2': '‡∏°.2', 'm3': '‡∏°.3' };

        const gradeThai = gradeMap[gradeKey];

        const schedule = scheduleData[gradeKey].schedule;

        const recordedList = recordedActivitiesData[gradeThai] || [];

        const tableBody = document.getElementById('activityStatusTableBody');

        tableBody.innerHTML = '';

        document.getElementById('printGradeReportBtn').textContent = `‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ ${gradeThai}`;

        schedule.forEach(row => {

            const isBreak = row.day1.includes('‡∏û‡∏±‡∏Å');

            let tableRow = `<tr class="${isBreak ? 'bg-gray-50' : ''}">`;

            tableRow += `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.time}</td>`;

            ['day1', 'day2', 'day3'].forEach((day, index) => {

                const activityName = row[day];

                const isRecorded = recordedList.includes(activityName);

                tableRow += `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">`;

                if (!isBreak) {

                    tableRow += `<div>${activityName}</div>`;

                    if (isRecorded) {

                        tableRow += `<div class="mt-2"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß</span></div>`;

                    } else {

                        tableRow += `<div class="mt-2"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">üÖæÔ∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span> <button onclick="openActivityModal('${row.time}', '${activityName.replace(/'/g, "\\'")}', ${index + 1})" class="ml-2 text-xs text-purple-600 hover:underline">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>`;

                    }

                } else {

                    tableRow += activityName;

                }

                tableRow += `</td>`;

            });

            tableRow += `</tr>`;

            tableBody.innerHTML += tableRow;

        });

    }



    // UPDATED FUNCTION with crossorigin attribute for images

// UPDATED FUNCTION with crossorigin attribute for images
// UPDATED FUNCTION with correct Thai keys for attendance
const createPrintContentForActivity = (details) => {
    const getImageUrl = (formula) => {
        if (!formula || typeof formula !== 'string' || !formula.startsWith('=IMAGE')) return '';
        try { return formula.match(/"(.*?)"/)[1]; } catch { return ''; }
    };
    const photo1Url = getImageUrl(details['Photo 1']);
    const photo2Url = getImageUrl(details['Photo 2']);
    const signatureUrl = getImageUrl(details['Signature']);

    return `
        <div class="print-form">
            <header class="form-header">
                <h1>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠</h1>
                <h2>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</h2>
            </header>

            <div class="data-grid">
                <div class="data-field"><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</strong><span>${details.Grade || ''}</span></div>
                <div class="data-field"><strong>‡∏Å‡∏≠‡∏á/‡∏´‡∏°‡∏π‡πà:</strong><span>${(details.Group || '') + ' / ' + (details.Troop || '')}</span></div>
                <div class="data-field"><strong>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</strong><span>${details.Activity || ''}</span></div>
                <div class="data-field"><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong><span>${details.Time || ''}</span></div>
                <div class="data-field full-width"><strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong><span>${details.Timestamp ? new Date(details.Timestamp).toLocaleString('th-TH') : ''}</span></div>
            </div>

            <div class="data-grid">
                <div class="data-field full-width">
                    <strong>‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</strong>
                    <span class="attendance-item">‡∏°‡∏≤ <span>${details.‡∏°‡∏≤ || 0}</span></span>
                    <span class="attendance-item">‡∏•‡∏≤ <span>${details.‡∏•‡∏≤ || 0}</span></span>
                    <span class="attendance-item">‡∏Ç‡∏≤‡∏î <span>${details.‡∏Ç‡∏≤‡∏î || 0}</span></span>
                    <span class="attendance-item">‡∏´‡∏ô‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span>${details.‡∏´‡∏ô‡∏µ || 0}</span></span>
                    </div>
            </div>
            
            <div class="data-grid">
                <div class="data-field full-width no-border"><strong>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</strong></div>
                <div class="data-field"><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°:</strong><span>${details['Total Score'] || 0} / 100</span></div>
                <div class="data-field"><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ú‡∏•:</strong><span>${details['Grade Level'] || 'N/A'}</span></div>
            </div>

            <div class="data-grid">
                <div class="data-field full-width"><strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô/‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ó‡πå:</strong><span>${details.Comments || ''}</span></div>
            </div>
            
            <section class="photo-section">
                <h3>‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                <div class="photo-grid">
                    <div class="photo-container">
                        ${photo1Url ? `<img src="${photo1Url}" crossorigin="anonymous">` : ''}
                        <p>‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 1</p>
                    </div>
                    <div class="photo-container">
                        ${photo2Url ? `<img src="${photo2Url}" crossorigin="anonymous">` : ''}
                        <p>‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà 2</p>
                    </div>
                </div>
            </section>

            <footer class="form-footer">
                <div class="signature-area">
                    <div class="signature-box">
                        ${signatureUrl ? `<img src="${signatureUrl}" crossorigin="anonymous" class="signature-img">` : ''}
                    </div>
                    <p>(‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏Å‡∏≥‡∏Å‡∏±‡∏ö)</p>
                </div>
            </footer>
        </div>
    `;
};
async function printGradeReport() {

    const gradeMap = { 'm1': '‡∏°.1', 'm2': '‡∏°.2', 'm3': '‡∏°.3' };

    const gradeThai = gradeMap[currentStatusGrade];

    Swal.fire({ title: `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ ${gradeThai}...`, html: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });



    try {

        const response = await fetch(`${SCRIPT_URL}?action=getActivitiesForGrade&grade=${encodeURIComponent(gradeThai)}`);

        if (!response.ok) throw new Error('Could not fetch activity details for the grade.');

        const activities = await response.json();



        if (!activities || activities.length === 0) {

            throw new Error(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${gradeThai}`);

        }

        

        let fullReportHtml = '';

        activities.forEach((details, index) => {

            const pageBreakClass = index > 0 ? 'page-break' : '';

            fullReportHtml += `<div class="single-page-activity ${pageBreakClass}">`;

            fullReportHtml += createPrintContentForActivity(details);

            fullReportHtml += `</div>`;

        });

        

        document.getElementById('printArea').innerHTML = fullReportHtml;



        // üü¢ [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô "‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå"

        const images = document.querySelectorAll('#printArea img');

        const promises = [];



        images.forEach(img => {

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ img.src ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á

            if (img.src && img.src !== window.location.href) {

                promises.push(new Promise((resolve) => {

                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡πá‡∏≠‡∏ö‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå Image ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤ cache ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå

                    const imageLoader = new Image();

                    imageLoader.onload = resolve;

                    imageLoader.onerror = resolve; // ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡∏£‡∏π‡∏õ‡πÉ‡∏î‡∏£‡∏π‡∏õ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÄ‡∏™‡∏µ‡∏¢

                    imageLoader.src = img.src;

                }));

            }

        });



        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Promise ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ) ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à

        Promise.all(promises).then(() => {

            Swal.close();

            // ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏•‡∏á DOM ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß

            setTimeout(() => {

                window.print();

            }, 250); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 0.25 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

        });



    } catch (error) {

        console.error(error);

        Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', error.message, 'error');

    }

}

    </script>

</body>

</html>
