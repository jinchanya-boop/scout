<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Prompt', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 50%, #ddd6fe 100%); }
        .card-shadow { box-shadow: 0 4px 20px rgba(139, 92, 246, 0.1); }
        .btn-primary { background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3); }
        .signature-pad { border: 2px dashed #c4b5fd; background: #faf5ff; }
        .rubric-item { background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); }
        .modal-overlay { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); }
        .file-input-label { cursor: pointer; background-color: #f3e8ff; border: 2px dashed #c4b5fd; }
        .file-input-label:hover { background-color: #e9d5ff; }
        .image-preview { width: 100%; height: 150px; object-fit: cover; border: 1px solid #ddd6fe; }
        /* Style adjustments might be needed based on the previous version */
        @media print { /* ... ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô print styles ... */ }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <header class="bg-white/90 backdrop-blur-md shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="https://img2.pic.in.th/pic/sa1.png" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤" class="w-12 h-12 rounded-full object-cover">
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</h1>
                        <p class="text-sm text-purple-600"> ‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ ‡∏°.1-‡∏°.3</p>
                    </div>
                </div>
                <select id="gradeSelect" class="px-4 py-2 rounded-lg border border-purple-200 focus:ring-2 focus:ring-purple-500">
                    <option value="m1">‡∏°.1 - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß</option>
                    <option value="m2">‡∏°.2 - ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ</option>
                    <option value="m3">‡∏°.3 - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥</option>
                </select>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
             <button onclick="openStudentManagement()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-purple-50 transition-colors">
                 <div class="flex items-center space-x-3"><span class="text-2xl">üë•</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3><p class="text-sm text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏•‡∏ö ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</p></div></div>
             </button>
             <button onclick="openAttendanceCheck()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-purple-50 transition-colors">
                 <div class="flex items-center space-x-3"><span class="text-2xl">‚úÖ</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3><p class="text-sm text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p></div></div>
             </button>
             <button onclick="openActivityStatusDashboard()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-indigo-50 transition-colors">
                 <div class="flex items-center space-x-3"><span class="text-2xl">üìë</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3><p class="text-sm text-gray-600">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå</p></div></div>
             </button>
             <button onclick="openDashboard()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-blue-50 transition-colors">
                 <div class="flex items-center space-x-3"><span class="text-2xl">üìà</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h3><p class="text-sm text-gray-600">‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</p></div></div>
             </button>
             <button onclick="showActivityReport()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-green-50 transition-colors">
                 <div class="flex items-center space-x-3"><span class="text-2xl">üìä</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3><p class="text-sm text-gray-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p></div></div>
             </button>
             <button onclick="showAttendanceReport()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-yellow-50 transition-colors">
                 <div class="flex items-center space-x-3"><span class="text-2xl">üìã</span><div class="text-left"><h3 class="font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h3><p class="text-sm text-gray-600">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p></div></div>
             </button>
        </div>

        <div class="bg-white/90 backdrop-blur-md rounded-2xl card-shadow p-6 mb-8">
            <div class="flex items-center mb-6"><span class="text-2xl mr-3">üìÖ</span><h2 class="text-2xl font-bold text-gray-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£ Block Course</h2></div>
            <div id="scheduleTable" class="overflow-x-auto">
                </div>
        </div>

        <div class="bg-white/90 backdrop-blur-md rounded-2xl card-shadow p-6 mb-8">
             <div class="flex items-center mb-6"><span class="text-2xl mr-3">üîÑ</span><h2 class="text-2xl font-bold text-gray-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏ê‡∏≤‡∏ô (Station Rotation)</h2></div>
             <div class="space-y-6">
                 <div>
                     <h3 class="text-xl font-semibold text-gray-800 mb-2">‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á</h3>
                     <p class="text-gray-700">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 4 ‡∏Å‡∏≠‡∏á (Troops) ‡πÇ‡∏î‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≠‡∏á‡∏à‡∏∞‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏° 4 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ (Stations) ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 4 ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (Time Slots)...</p>
                     <ul class="list-disc list-inside text-gray-700 mt-3 space-y-1">
                         <li><strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô:</strong> 1 ‡∏Å‡∏≠‡∏á (Troop)</li>
                         <li><strong>‡∏°.1 (4 ‡∏Å‡∏≠‡∏á x 4 ‡∏´‡∏°‡∏π‡πà):</strong> ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                         <li><strong>‡∏°.2 (4 ‡∏Å‡∏≠‡∏á x 4 ‡∏´‡∏°‡∏π‡πà):</strong> ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                         <li><strong>‡∏°.3 (4 ‡∏Å‡∏≠‡∏á x 3 ‡∏´‡∏°‡∏π‡πà):</strong> ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô</li>
                     </ul>
                 </div>
                 <div class="overflow-x-auto">
                     <h3 class="text-xl font-semibold text-gray-800 mb-3">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏ê‡∏≤‡∏ô (4x4)</h3>
                     <table class="w-full min-w-lg text-left border-collapse">
                         <thead class="bg-gray-100">
                             <tr>
                                 <th class="py-3 px-4 font-semibold text-gray-700 border border-gray-200">‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏Å‡∏≠‡∏á</th>
                                 <th class="py-3 px-4 font-semibold text-gray-700 border border-gray-200 text-center bg-blue-50">‡∏Å‡∏≠‡∏á‡∏ó‡∏µ‡πà 1</th>
                                 <th class="py-3 px-4 font-semibold text-gray-700 border border-gray-200 text-center bg-green-50">‡∏Å‡∏≠‡∏á‡∏ó‡∏µ‡πà 2</th>
                                 <th class="py-3 px-4 font-semibold text-gray-700 border border-gray-200 text-center bg-amber-50">‡∏Å‡∏≠‡∏á‡∏ó‡∏µ‡πà 3</th>
                                 <th class="py-3 px-4 font-semibold text-gray-700 border border-gray-200 text-center bg-rose-50">‡∏Å‡∏≠‡∏á‡∏ó‡∏µ‡πà 4</th>
                             </tr>
                         </thead>
                         <tbody>
                             <tr class="hover:bg-gray-50"><td class="py-3 px-4 font-medium text-gray-600 border border-gray-200">‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 1 (09:00-10:00)</td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-blue-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ A</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-green-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ B</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-amber-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ C</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-rose-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ D</span></td></tr>
                             <tr class="hover:bg-gray-50"><td class="py-3 px-4 font-medium text-gray-600 border border-gray-200">‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 2 (10:00-11:00)</td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-rose-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ D</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-blue-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ A</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-green-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ B</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-amber-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ C</span></td></tr>
                             <tr class="hover:bg-gray-50"><td class="py-3 px-4 font-medium text-gray-600 border border-gray-200">‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 3 (13:00-14:00)</td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-amber-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ C</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-rose-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ D</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-blue-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ A</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-green-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ B</span></td></tr>
                             <tr class="hover:bg-gray-50"><td class="py-3 px-4 font-medium text-gray-600 border border-gray-200">‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà 4 (14:00-15:00)</td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-green-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ B</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-amber-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ C</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-rose-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ D</span></td><td class="py-3 px-4 border border-gray-200 text-center"><span class="font-bold text-blue-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ A</span></td></tr>
                         </tbody>
                     </table>
                 </div>
            </div>
        </div>
    </main>

    <div id="studentManagementModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4"> </div>
    <div id="attendanceModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4"> </div>
    <div id="activityModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4"> </div>
    <div id="dashboardModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4"> </div>
    <div id="activityStatusModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4"> </div>
    <div id="printArea" class="hidden font-sans"></div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyhidTjPGC6HvQ0Jmv7eIR4IVYKdDqI7nES5Ovexyj-m9QriFYa9Mm9AYBoJr5-Sgzw/exec';

    let studentData = {};
    let editingStudent = null;
    let canvas, ctx, isDrawing = false;
    let attendanceSummaryData = null;
    let activitySummaryData = null;
    let attendanceChartInstance = null;
    let scoreChartInstance = null;
    let recordedActivitiesData = null;
    let currentStatusGrade = 'm1';

    // ‚ú® ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ scheduleData ‚ú®
    const scheduleData = {
        m1:{title:"‡∏°.1 - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß",focus:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ ‚Äì ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ‚Äì ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏π‡πà",schedule:[{time:"08.30 ‚Äì 09.00",day1:"‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î / ‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û‡∏ò‡∏á‡∏ä‡∏≤‡∏ï‡∏¥",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á"},{time:"09.00 ‚Äì 10.00",day1:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏ñ‡∏ß (‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô)",day2:"‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏• (2‚Äì3 ‡∏Å‡∏°.)",day3:"‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ö‡∏≤‡∏î‡πÅ‡∏ú‡∏•‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢"},{time:"10.00 ‚Äì 10.15",day1:"‡∏û‡∏±‡∏Å",day2:"‡∏û‡∏±‡∏Å",day3:"‡∏û‡∏±‡∏Å"},{time:"10.15 ‚Äì 11.15",day1:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡∏û‡∏¥‡∏£‡∏≠‡∏î, ‡∏ï‡∏∞‡∏Å‡∏£‡∏∏‡∏î‡πÄ‡∏ö‡πá‡∏î, ‡∏Ç‡∏±‡∏î‡∏™‡∏°‡∏≤‡∏ò‡∏¥)",day2:"‡∏ù‡∏∂‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®",day3:"‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡πÑ‡∏ü‡∏á‡πà‡∏≤‡∏¢ ‡πÜ"},{time:"11.15 ‚Äì 12.00",day1:"‡πÄ‡∏Å‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Teamwork",day3:"‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ú‡∏π‡∏Å‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô"},{time:"12.00 ‚Äì 13.00",day1:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day2:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day3:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô"},{time:"13.00 ‚Äì 14.30",day1:"‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô",day2:"‡∏ö‡∏≥‡πÄ‡∏û‡πá‡∏ç‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô + ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®)"},{time:"14.30 ‚Äì 15.30",day1:"‡πÄ‡∏Å‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥-‡∏ú‡∏π‡πâ‡∏ï‡∏≤‡∏°",day2:"‡πÄ‡∏û‡∏•‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠",day3:"‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î (Reflection)"},{time:"15.30 ‚Äì 16.00",day1:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day2:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day3:"‡∏û‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î + ‡∏°‡∏≠‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£"}]},
        m2:{title:"‡∏°.2 - ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö",focus:"‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ ‚Äì ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå ‚Äì ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏•‡∏à‡∏£‡∏¥‡∏á ‚Äì ‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏Ç‡∏±‡πâ‡∏ô‡∏Å‡∏•‡∏≤‡∏á",schedule:[{time:"08.30 ‚Äì 09.00",day1:"‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î / ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á"},{time:"09.00 ‚Äì 10.00",day1:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏°‡∏π‡πà, ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ñ‡∏ß)",day2:"‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏• (4‚Äì5 ‡∏Å‡∏°.)",day3:"‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î, ‡∏´‡∏≤‡∏°‡∏ú‡∏π‡πâ‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö)"},{time:"10.00 ‚Äì 10.15",day1:"‡∏û‡∏±‡∏Å",day2:"‡∏û‡∏±‡∏Å",day3:"‡∏û‡∏±‡∏Å"},{time:"10.15 ‚Äì 11.15",day1:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå (‡∏ö‡πà‡∏ß‡∏á‡∏™‡∏≤‡∏¢‡∏ò‡∏ô‡∏π, ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏±‡∏ö‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤)",day2:"‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ / ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ",day3:"‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß"},{time:"11.15 ‚Äì 12.00",day1:"‡πÄ‡∏Å‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥-‡∏ú‡∏π‡πâ‡∏ï‡∏≤‡∏°",day2:"‡∏ê‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à/Team Building",day3:"‡πÄ‡∏Å‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå"},{time:"12.00 ‚Äì 13.00",day1:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day2:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day3:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô"},{time:"13.00 ‚Äì 14.30",day1:"‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà",day2:"‡∏ö‡∏≥‡πÄ‡∏û‡πá‡∏ç‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (‡∏ä‡∏∏‡∏°‡∏ä‡∏ô/‡∏ß‡∏±‡∏î)",day3:"‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ê‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô + ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏® + ‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•)"},{time:"14.30 ‚Äì 15.30",day1:"‡πÄ‡∏Å‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡∏°",day2:"‡πÄ‡∏û‡∏•‡∏á‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î"},{time:"15.30 ‚Äì 16.00",day1:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day2:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day3:"‡∏û‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î + ‡∏°‡∏≠‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£"}]},
        m3:{title:"‡∏°.3 - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î",focus:"‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥ ‚Äì ‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‚Äì ‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î ‚Äì ‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ",schedule:[{time:"08.30 ‚Äì 09.00",day1:"‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏õ‡∏¥‡∏î / ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏≤‡∏ò‡∏á"},{time:"09.00 ‚Äì 10.00",day1:"‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÅ‡∏ñ‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤ (‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏°‡∏π‡πà)",day2:"‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏• (6‚Äì8 ‡∏Å‡∏°. + ‡∏ê‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á)",day3:"‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (‡∏î‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å, ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢)"},{time:"10.00 ‚Äì 10.15",day1:"‡∏û‡∏±‡∏Å",day2:"‡∏û‡∏±‡∏Å",day3:"‡∏û‡∏±‡∏Å"},{time:"10.15 ‚Äì 11.15",day1:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏ú‡∏π‡∏Å‡∏£‡∏≠‡∏Å, ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏°‡∏≠)",day2:"‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô / ‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏ä‡∏∏‡∏°‡∏ä‡∏ô",day3:"‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡∏£‡∏≠‡∏î (‡∏´‡∏≤‡∏ô‡πâ‡∏≥, ‡∏´‡∏≤‡∏ó‡∏¥‡∏®‡∏à‡∏≤‡∏Å‡∏î‡∏ß‡∏á‡∏î‡∏≤‡∏ß)"},{time:"11.15 ‚Äì 12.00",day1:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥ (‡∏ù‡∏∂‡∏Å‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å)",day2:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏ê‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢",day3:"‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏°.3 ‡∏à‡∏±‡∏î‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏á ‡∏°.1‚Äì‡∏°.2"},{time:"12.00 ‚Äì 13.00",day1:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day2:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô",day3:"‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô"},{time:"13.00 ‚Äì 14.30",day1:"‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®",day2:"‡∏ö‡∏≥‡πÄ‡∏û‡πá‡∏ç‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå (‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏•‡πá‡∏Å ‡πÜ)",day3:"‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏ê‡∏≤‡∏ô‡∏£‡∏ß‡∏° (‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô + ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏® + ‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• + ‡∏†‡∏≤‡∏ß‡∏∞‡∏ú‡∏π‡πâ‡∏ô‡∏≥)"},{time:"14.30 ‚Äì 15.30",day1:"‡πÄ‡∏Å‡∏°‡∏ú‡∏π‡πâ‡∏ô‡∏≥-‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à",day2:"‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå (Mini Camp Fire)",day3:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î"},{time:"15.30 ‚Äì 16.00",day1:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day2:"‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",day3:"‡∏û‡∏¥‡∏ò‡∏µ‡∏õ‡∏¥‡∏î + ‡∏°‡∏≠‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£"}]}
    };
    const rubricCriteria = { /* ... ‡πÇ‡∏Ñ‡πâ‡∏î rubricCriteria ... */ };

    document.addEventListener('DOMContentLoaded', function () {
        fetchStudents();
        // ‚ú® ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ Event Listener ‡πÉ‡∏´‡πâ gradeSelect ‚ú®
        const gradeSelect = document.getElementById('gradeSelect');
        if (gradeSelect) {
            gradeSelect.addEventListener('change', loadSchedule);
        } else {
            console.error("Grade select dropdown not found!");
        }

        const activityForm = document.getElementById('activityForm');
        if (activityForm) {
             activityForm.addEventListener('submit', (e) => {
                 e.preventDefault();
                 saveActivityRecord();
             });
        } else {
            console.error("Activity form not found on DOMContentLoaded!");
        }
    });

    async function fetchStudents() {
        try { /* ... ‡πÇ‡∏Ñ‡πâ‡∏î fetchStudents ... */ }
        catch (error) { /* ... */ }
        finally {
             // ‚ú® ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å loadSchedule() ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à ‚ú®
             loadSchedule();
        }
    }

    // ‚ú® ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadSchedule() ‚ú®
    function loadSchedule(){
        const gradeSelect = document.getElementById('gradeSelect');
        const tableContainer = document.getElementById('scheduleTable');
        if (!gradeSelect || !tableContainer) {
             console.error("Required elements for schedule not found.");
             return; // Exit if elements are missing
        }
        const selectedGrade = gradeSelect.value;
        const data = scheduleData[selectedGrade];
        let html=`<div class="mb-4"><h3 class="text-lg font-semibold text-purple-800">${data.title}</h3><p class="text-sm text-gray-600 mt-1"><strong>‡∏à‡∏∏‡∏î‡πÄ‡∏ô‡πâ‡∏ô:</strong> ${data.focus}</p></div><div class="overflow-x-auto"><table class="w-full border-collapse"><thead><tr class="bg-gradient-to-r from-purple-500 to-purple-600 text-white"><th class="border p-3 text-left">‡πÄ‡∏ß‡∏•‡∏≤</th><th class="border p-3 text-left">‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å</th><th class="border p-3 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á</th><th class="border p-3 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°</th></tr></thead><tbody>`;
        data.schedule.forEach(row=>{
            const isBreak = row.day1.includes('‡∏û‡∏±‡∏Å') || row.day2.includes('‡∏û‡∏±‡∏Å') || row.day3.includes('‡∏û‡∏±‡∏Å'); // Check if any day is a break
            // ‚ú® Pass 'day index' (1, 2, or 3) to openActivityModal ‚ú®
            const btn = (dayIndex, activity) => !isBreak ? `<button onclick="openActivityModal('${row.time}','${activity.replace(/'/g,"\\'")}', ${dayIndex})" class="ml-2 px-2 py-1 bg-purple-500 text-white text-xs rounded-full hover:bg-purple-600 flex-shrink-0">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>` : '';
            html+=`<tr class="${isBreak?'bg-purple-50':'bg-white hover:bg-purple-50'}">
                    <td class="border p-3 font-medium text-purple-700">${row.time}</td>
                    <td class="border p-3"><div class="flex items-center justify-between"><span>${row.day1}</span>${btn(1, row.day1)}</div></td>
                    <td class="border p-3"><div class="flex items-center justify-between"><span>${row.day2}</span>${btn(2, row.day2)}</div></td>
                    <td class="border p-3"><div class="flex items-center justify-between"><span>${row.day3}</span>${btn(3, row.day3)}</div></td>
                  </tr>`;
        });
        html+=`</tbody></table></div>`;
        tableContainer.innerHTML = html;
    }

    // ‚ùå ‡∏•‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô showScheduleGrade ‡πÅ‡∏•‡∏∞ showScheduleTerm ‚ùå
    // function showScheduleGrade(gradeId) { ... }
    // function showScheduleTerm(gradeId, term) { ... }

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå) ---
    async function postData(payload) { /* ... */ }
    function openDashboard(){ /* ... */ }
    function closeDashboard(){ /* ... */ }
    async function loadDashboardData(){ /* ... */ }
    function renderDashboardCharts(){ /* ... */ }
    function loadManageStudentList(){ /* ... */ }
    function showAddStudentForm(){ /* ... */ }
    async function saveStudent(){ /* ... */ }
    function editStudent(grade,group,troop,index){ /* ... */ }
    function deleteStudent(grade,group,troop,index){ /* ... */ }
    function loadAttendanceStudentList(){ /* ... */ }
    async function saveAttendance(){ /* ... */ }
    function loadStudentList(){ /* ... */ }
    function updateAttendanceSummary(){ /* ... */ }
    function previewImage(inputId, previewId) { /* ... */ }
    function resizeImage(file, maxWidth = 800, maxHeight = 800, quality = 0.8) { /* ... */ }
    async function saveActivityRecord() { /* ... */ }
    function updateTroopOptions(groupElId,troopElId){ /* ... */ }
    function updateManageTroopOptions(){ /* ... */ }
    function updateAttendanceTroopOptions(){ /* ... */ }
    function updateActivityTroopOptions(){ /* ... */ }
    function openStudentManagement(){ /* ... */ }
    function closeStudentManagement(){ /* ... */ }
    function openAttendanceCheck(){ /* ... */ }
    function closeAttendanceCheck(){ /* ... */ }
    function openActivityModal(time, activity, day) { // Parameter 'day' is now 1, 2, or 3
        console.log(`Opening modal for: Time=${time}, Activity=${activity}, Day=${day}`);
        try {
            const activityModal = document.getElementById('activityModal');
            const activityTimeInput = document.getElementById('activityTime');
            const activityNameInput = document.getElementById('activityName');

            if (!activityModal || !activityTimeInput || !activityNameInput) {
                console.error("Modal elements not found!");
                Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
                return;
            }

            // Reset form fields before showing modal
            const form = document.getElementById('activityForm');
            if(form) form.reset();
            const photo1 = document.getElementById('photoPreview1');
            const photo2 = document.getElementById('photoPreview2');
            if(photo1) { photo1.classList.add('hidden'); photo1.src = ''; }
            if(photo2) { photo2.classList.add('hidden'); photo2.src = ''; }
            const studentList = document.getElementById('studentAttendanceList');
            const attendanceSum = document.getElementById('attendanceSummary');
            if(studentList) studentList.classList.add('hidden');
            if(attendanceSum) attendanceSum.classList.add('hidden');
            clearSignature();

            // Show modal and set values
            activityModal.classList.remove('hidden');
            activityTimeInput.value = time; // Set time from schedule row
            activityNameInput.value = activity; // Set activity name

            let criteriaKey = 'default';
            if (['‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô', '‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏¥‡∏®', '‡∏õ‡∏ê‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•', '‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà', '‡∏Å‡πà‡∏≠‡πÑ‡∏ü'].some(s => activity.includes(s))) criteriaKey = 'skill';
            else if (['‡∏ú‡∏π‡πâ‡∏ô‡∏≥', '‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏≤', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', '‡∏õ‡∏ê‡∏°‡∏ô‡∏¥‡πÄ‡∏ó‡∏®'].some(s => activity.includes(s))) criteriaKey = 'leadership';
            loadRubricItems(rubricCriteria[criteriaKey]);
            setupSignatureCanvas();

        } catch (error) {
            console.error("Error in openActivityModal:", error);
            Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ: ${error.message}`, 'error');
        }
    }
    function closeModal() { const modal = document.getElementById('activityModal'); if(modal) modal.classList.add('hidden'); }
    function hideStudentForm(){ /* ... */ }
    function loadRubricItems(criteria){ /* ... */ }
    function updateRubricScore(){ /* ... */ }
    function setupSignatureCanvas(){ /* ... */ }
    function getCoords(e){ /* ... */ }
    function startDraw(e){ /* ... */ }
    function draw(e){ /* ... */ }
    function stopDraw(){ /* ... */ }
    function drawLine(x,y){ /* ... */ }
    function clearSignature(){ /* ... */ }
    function saveDataLocally(data, key) { /* ... */ }
    function showSuccessMessage(data,isOffline=false){ /* ... */ }
    async function showActivityReport(){ /* ... */ }
    async function showAttendanceReport(){ /* ... */ }
    async function openActivityStatusDashboard() { /* ... */ }
    function closeActivityStatusDashboard() { /* ... */ }
    function setActiveTab(selectedTab) { /* ... */ }
    function renderActivityStatusTable(gradeKey) { // This now uses scheduleData again
        currentStatusGrade = gradeKey;
        const gradeMap = { 'm1': '‡∏°.1', 'm2': '‡∏°.2', 'm3': '‡∏°.3' };
        const gradeThai = gradeMap[gradeKey];
        const schedule = scheduleData[gradeKey]?.schedule; // Use the restored scheduleData
        const recordedList = recordedActivitiesData && recordedActivitiesData[gradeThai] ? recordedActivitiesData[gradeThai] : [];
        const tableBody = document.getElementById('activityStatusTableBody');
        const printBtn = document.getElementById('printGradeReportBtn');

        if (!tableBody || !printBtn) { console.error("Table body or print button not found for status modal"); return;}
        tableBody.innerHTML = ''; // Clear previous content
        printBtn.textContent = `‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ ${gradeThai}`;

        if (schedule && schedule.length > 0) {
            schedule.forEach(row => {
                const isBreak = row.day1.includes('‡∏û‡∏±‡∏Å') || row.day2.includes('‡∏û‡∏±‡∏Å') || row.day3.includes('‡∏û‡∏±‡∏Å');
                let tableRow = `<tr class="${isBreak ? 'bg-gray-50' : ''}">`;
                tableRow += `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.time}</td>`;
                ['day1', 'day2', 'day3'].forEach((dayKey, index) => {
                    const activityName = row[dayKey];
                    tableRow += `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">`;
                    if (!isBreak) {
                        const isRecorded = recordedList.includes(activityName);
                        tableRow += `<div>${activityName}</div>`;
                        tableRow += `<div class="mt-2"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${isRecorded ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${isRecorded ? '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß' : 'üÖæÔ∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'}</span>`;
                        if (!isRecorded) {
                            tableRow += ` <button onclick="openActivityModal('${row.time}', '${activityName.replace(/'/g, "\\'")}', ${index + 1})" class="ml-2 text-xs text-purple-600 hover:underline">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>`;
                        }
                        tableRow += `</div>`;
                    } else {
                        tableRow += activityName; // Just display "‡∏û‡∏±‡∏Å"
                    }
                    tableRow += `</td>`;
                });
                tableRow += `</tr>`;
                tableBody.innerHTML += tableRow;
            });
        } else {
             tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-10 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${gradeThai}</td></tr>`;
        }
    }
    const createPrintContentForActivity = (details) => { /* ... ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏° ... */ };
    async function printGradeReport() { /* ... ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏° ... */ }
    async function syncOfflineData() { /* ... ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏° ... */ }
     window.addEventListener('online', syncOfflineData);
     if (navigator.onLine) { syncOfflineData(); }
</script>
</body>
</html>
