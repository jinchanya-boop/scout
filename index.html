<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <style>
        body {
            box-sizing: border-box;
            font-family: 'Prompt', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 50%, #ddd6fe 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        /* ‚ú® ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Accordion ‡πÉ‡∏ô‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î */
        details > summary {
            cursor: pointer;
            list-style: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
        }
        details > summary::-webkit-details-marker {
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£‡πÉ‡∏ô Chrome/Safari */
        }
        details > summary::before {
            content: '‚ñ∂';
            margin-right: 0.5rem;
            display: inline-block;
            transition: transform 0.2s;
        }
        details[open] > summary::before {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <header class="bg-white/90 backdrop-blur-md shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-xl">üèïÔ∏è</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠‡∏™‡∏≤‡∏°‡∏±‡∏ç‡∏£‡∏∏‡πà‡∏ô‡πÉ‡∏´‡∏ç‡πà - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≤</h1>
                        <p class="text-sm text-purple-600"> ‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ ‡∏°.1-‡∏°.3</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <select id="gradeSelect" class="px-4 py-2 rounded-lg border border-purple-200 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="m1">‡∏°.1 - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß</option>
                        <option value="m2">‡∏°.2 - ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ</option>
                        <option value="m3">‡∏°.3 - ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ô‡∏≥</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <button onclick="openStudentManagement()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-purple-50 transition-colors duration-200">
                <div class="flex items-center space-x-3">
                    <span class="text-3xl">üë•</span>
                    <div class="text-left">
                        <h3 class="font-semibold text-gray-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                        <p class="text-sm text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏•‡∏ö ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    </div>
                </div>
            </button>
            <button onclick="openAttendanceCheck()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-purple-50 transition-colors duration-200">
                <div class="flex items-center space-x-3">
                    <span class="text-3xl">‚úÖ</span>
                    <div class="text-left">
                        <h3 class="font-semibold text-gray-800">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                        <p class="text-sm text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</p>
                    </div>
                </div>
            </button>
            <button onclick="showDashboard()" class="bg-white/90 backdrop-blur-md rounded-xl card-shadow p-4 hover:bg-green-50 transition-colors duration-200 md:col-span-1 lg:col-span-1">
                <div class="flex items-center space-x-3">
                    <span class="text-3xl">üìä</span>
                    <div class="text-left">
                        <h3 class="font-semibold text-gray-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>
                        <p class="text-sm text-gray-600">‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</p>
                    </div>
                </div>
            </button>
        </div>

        <div class="bg-white/90 backdrop-blur-md rounded-2xl card-shadow p-6 mb-8">
            <div class="flex items-center mb-6">
                <span class="text-2xl mr-3">üìÖ</span>
                <h2 class="text-2xl font-bold text-gray-800">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏≠‡∏£‡πå‡∏™</h2>
            </div>
            <div id="scheduleTable" class="overflow-x-auto"></div>
        </div>
    </main>

    <div id="dashboardModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-purple-100">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">üìä</span>
                        <h3 class="text-xl font-bold text-gray-800">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>
                    </div>
                    <button onclick="closeDashboard()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
            </div>
            <div class="p-6 overflow-y-auto space-y-6">
                <div>
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center"><span class="mr-2">‚úÖ</span>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                    <div id="attendanceDashboard" class="space-y-2 text-sm">
                        </div>
                </div>

                <hr class="border-purple-200">

                <div>
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center"><span class="mr-2">‚≠ê</span>‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h4>
                    <div id="activityDashboard" class="space-y-2 text-sm">
                        </div>
                </div>
                 <div>
                    <h4 class="text-lg font-semibold text-gray-800 mb-3 flex items-center"><span class="mr-2">üìà</span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <canvas id="gradeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏≤‡∏ß‡∏≤‡∏á)
        // ...

        // ‚ú® ======================================================= -->
        // ‚ú®         ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢)          -->
        // ‚ú® ======================================================= -->

        let gradeChartInstance = null; // ‚ú® ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö instance ‡∏Ç‡∏≠‡∏á chart

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
        function closeDashboard() {
            document.getElementById('dashboardModal').classList.add('hidden');
        }

        async function showDashboard() {
            const modal = document.getElementById('dashboardModal');
            modal.classList.remove('hidden');
            
            const attendanceContainer = document.getElementById('attendanceDashboard');
            const activityContainer = document.getElementById('activityDashboard');

            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
            attendanceContainer.innerHTML = `<p class="text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠...</p>`;
            activityContainer.innerHTML = `<p class="text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô...</p>`;

            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß
                const [attendanceRes, activityRes] = await Promise.all([
                    fetch(SCRIPT_URL + '?action=getAttendanceSummary'),
                    fetch(SCRIPT_URL + '?action=getActivitySummary')
                ]);

                if (!attendanceRes.ok || !activityRes.ok) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ');
                }

                const attendanceSummary = await attendanceRes.json();
                const activitySummary = await activityRes.json();

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                buildAttendanceDashboard(attendanceSummary);
                buildActivityDashboard(activitySummary);
                createGradeChart(activitySummary); // ‚ú® ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü

            } catch (error) {
                console.error("Error fetching dashboard data:", error);
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonColor: '#8b5cf6'
                });
                closeDashboard();
            }
        }
        function createGradeChart(summaryData) {
            const ctx = document.getElementById('gradeChart').getContext('2d');
            const labels = Object.keys(summaryData);
            const data = labels.map(grade => {
                const gradeData = summaryData[grade];
                return (gradeData.totalScore / gradeData.count).toFixed(2);
            });

            // ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢ Chart ‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
            if (gradeChartInstance) {
                gradeChartInstance.destroy();
            }

            gradeChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels.map(l => `‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô ${l.replace('m', '‡∏°.')}`),
                    datasets: [{
                        label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',
                        data: data,
                        backgroundColor: [
                            'rgba(167, 139, 250, 0.6)',
                            'rgba(129, 140, 248, 0.6)',
                            'rgba(99, 102, 241, 0.6)'
                        ],
                        borderColor: [
                            'rgba(139, 92, 246, 1)',
                            'rgba(99, 102, 241, 1)',
                            'rgba(79, 70, 229, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100 // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏° 100
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: '‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô'
                        }
                    }
                }
            });
        }
        function buildAttendanceDashboard(summary) {
            const container = document.getElementById('attendanceDashboard');
            if (Object.keys(summary).length === 0) {
                container.innerHTML = `<p class="text-center text-gray-500 py-4">-- ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ --</p>`;
                return;
            }

            let html = '<div class="space-y-2">';
            const statusColors = { '‡∏°‡∏≤': 'text-green-600', '‡∏•‡∏≤': 'text-yellow-600', '‡∏Ç‡∏≤‡∏î': 'text-red-600', '‡∏´‡∏ô‡∏µ': 'text-orange-600' };

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô ‡∏°.1, ‡∏°.2, ‡∏°.3
            const sortedGrades = Object.keys(summary).sort();

            for (const grade of sortedGrades) {
                html += `<details class="bg-gray-50 rounded-lg border border-gray-200">
                            <summary class="p-3 font-semibold text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô ${grade.replace('m', '‡∏°.')}</summary>
                            <div class="px-4 pb-3 border-t border-gray-200 space-y-2 pt-2">`;
                
                const sortedGroups = Object.keys(summary[grade]).sort();
                for (const group of sortedGroups) {
                    html += `<details class="bg-white rounded border">
                                <summary class="p-2 font-medium text-purple-800">${group}</summary>
                                <div class="px-3 pb-2 border-t space-y-1 pt-2">`;
                    
                    const sortedTroops = Object.keys(summary[grade][group]).sort();
                    for (const troop of sortedTroops) {
                        const data = summary[grade][group][troop];
                        const statusText = Object.entries(data)
                            .filter(([key]) => key !== 'total')
                            .map(([status, count]) => `<span class="${statusColors[status] || ''}">${status}: ${count}</span>`)
                            .join(' | ');
                        
                        html += `<div class="flex justify-between items-center p-2 rounded hover:bg-purple-50">
                                    <span class="font-medium text-gray-600">${troop}</span>
                                    <span class="text-xs font-mono">${statusText}</span>
                                 </div>`;
                    }
                    html += `</div></details>`;
                }
                html += `</div></details>`;
            }
            html += '</div>';
            container.innerHTML = html;
        }

        function buildActivityDashboard(summary) {
            const container = document.getElementById('activityDashboard');
            if (Object.keys(summary).length === 0) {
                container.innerHTML = `<p class="text-center text-gray-500 py-4">-- ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô --</p>`;
                return;
            }

            let html = '<div class="space-y-2">';
            const sortedGrades = Object.keys(summary).sort();

            for (const grade of sortedGrades) {
                const gradeData = summary[grade];
                const gradeAvg = (gradeData.totalScore / gradeData.count).toFixed(2);
                
                html += `<details class="bg-green-50 rounded-lg border border-green-200">
                            <summary class="p-3 font-semibold text-green-800 flex justify-between">
                                <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô ${grade.replace('m', '‡∏°.')}</span>
                                <span>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${gradeAvg}</span>
                            </summary>
                            <div class="px-4 pb-3 border-t border-green-200 space-y-2 pt-2">`;
                
                const sortedGroups = Object.keys(gradeData.groups).sort();
                for (const group of sortedGroups) {
                    const groupData = gradeData.groups[group];
                    const groupAvg = (groupData.totalScore / groupData.count).toFixed(2);
                    
                    html += `<details class="bg-white rounded border">
                                <summary class="p-2 font-medium text-blue-800 flex justify-between">
                                    <span>${group}</span>
                                    <span>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${groupAvg}</span>
                                </summary>
                                <div class="px-3 pb-2 border-t space-y-1 pt-2">`;

                    const sortedTroops = Object.keys(groupData.troops).sort();
                    for (const troop of sortedTroops) {
                        const troopData = groupData.troops[troop];
                        const troopAvg = (troopData.totalScore / troopData.count).toFixed(2);

                        html += `<div class="flex justify-between items-center p-2 rounded hover:bg-green-50">
                                     <span class="font-medium text-gray-600">${troop}</span>
                                     <span class="font-semibold text-gray-700">${troopAvg} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                                 </div>`;
                    }
                    html += `</div></details>`;
                }
                html += `</div></details>`;
            }
            html += '</div>';
            container.innerHTML = html;
        }

    </script>
</body>
</html>
